<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Nicole Erler" />

<meta name="date" content="2018-12-04" />

<title>Model Specification</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; }  code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>

</head>

<body>




<h1 class="title toc-ignore">Model Specification</h1>
<h4 class="author"><em>Nicole Erler</em></h4>
<h4 class="date"><em>2018-12-04</em></h4>


<div id="TOC">
<ul>
<li><a href="#analysis-model-type">Analysis model type</a><ul>
<li><a href="#model-family-and-link-functions">Model family and link functions</a></li>
</ul></li>
<li><a href="#ModelFormula">Model formula</a><ul>
<li><a href="#interactions">Interactions</a><ul>
<li><a href="#interaction-with-multiple-variables">Interaction with multiple variables</a></li>
<li><a href="#higher-level-interactions">Higher level interactions</a></li>
</ul></li>
<li><a href="#non-linear-functional-forms">Non-linear functional forms</a><ul>
<li><a href="#what-happens-inside-jointai">What happens inside <strong>JointAI</strong>?</a></li>
<li><a href="#functions-with-restricted-support">Functions with restricted support</a></li>
<li><a href="#functions-that-are-not-available-in-r">Functions that are not available in R</a></li>
<li><a href="#nested-functions">Nested functions</a></li>
</ul></li>
</ul></li>
<li><a href="#MultiLevelStructure">Multi level structure &amp; longitudinal covariates</a><ul>
<li><a href="#random-effects">Random effects</a></li>
<li><a href="#longitudinal-covariates">Longitudinal covariates</a></li>
</ul></li>
<li><a href="#meth">Imputation model types</a><ul>
<li><a href="#specification-of-imputation-model-types">Specification of imputation model types</a></li>
<li><a href="#order-of-the-sequence-of-imputation-models">Order of the sequence of imputation models</a></li>
</ul></li>
<li><a href="#auxvars">Auxiliary variables</a><ul>
<li><a href="#functions-of-variables-as-auxiliary-variables">Functions of variables as auxiliary variables</a></li>
<li><a href="#note">Note:</a></li>
</ul></li>
<li><a href="#reference-values-for-categorical-covariates">Reference values for categorical covariates</a><ul>
<li><a href="#setting-reference-categories-for-all-variables">Setting reference categories for all variables</a></li>
<li><a href="#setting-reference-categories-for-individual-variables">Setting reference categories for individual variables</a></li>
<li><a href="#some-notes">Some notes</a></li>
</ul></li>
<li><a href="#hyperparameters">Hyperparameters</a><ul>
<li><a href="#scaling">Scaling</a></li>
</ul></li>
<li><a href="#scaling-1">Scaling</a></li>
</ul>
</div>

<p>In this vignette we use the <a href="https://nerler.github.io/JointAI/reference/NHANES.html">NHANES</a> data for examples in cross-sectional data and the dataset <a href="https://nerler.github.io/JointAI/reference/simLong.html">simLong</a> for examples in longitudinal data. For more info on these datasets, check out the vignette <a href="https://nerler.github.io/JointAI/articles/VisualizingIncompleteData.html"><em>Visualizing Incomplete Data</em></a>, in which the distributions of variables and missing values in both sets is explored.</p>
<p><strong>Note:</strong><br> In many of the examples we use <code>n.adapt = 0</code> (and <code>n.iter = 0</code>, which is the default) in order to prevent the MCMC sampling and, hence, reduce computational time. <code>mess = FALSE</code> is used to suppress messages that are not of interest in this vignette.</p>
<div id="analysis-model-type" class="section level2">
<h2>Analysis model type</h2>
<p><strong>JointAI</strong> has five main functions:</p>
<ul>
<li><a href="https://nerler.github.io/JointAI/reference/model_imp.html"><code>lm_imp()</code></a>: linear regression</li>
<li><a href="https://nerler.github.io/JointAI/reference/model_imp.html"><code>glm_imp()</code></a>: generalized linear regression</li>
<li><a href="https://nerler.github.io/JointAI/reference/model_imp.html"><code>lme_imp()</code></a>: linear mixed effects regression</li>
<li><a href="https://nerler.github.io/JointAI/reference/model_imp.html"><code>glme_imp()</code></a>: generalized linear mixed effects regression</li>
<li><a href="https://nerler.github.io/JointAI/reference/model_imp.html"><code>survreg_imp()</code></a>: linear mixed effects regression</li>
</ul>
<p>Specification of these functions is similar to the specification of the complete data versions <a href="https://stat.ethz.ch/R-manual/R-devel/library/stats/html/lm.html"><code>lm()</code></a>, <a href="https://stat.ethz.ch/R-manual/R-devel/library/stats/html/glm.html"><code>glm()</code></a>, <a href="https://stat.ethz.ch/R-manual/R-devel/library/nlme/html/lme.html"><code>lme()</code></a> (from package <strong>nlme</strong>) and <a href="https://stat.ethz.ch/R-manual/R-devel/library/survival/html/survreg.html"><code>survreg()</code></a> (from package <strong>survival</strong>). <code>glme_imp()</code> uses a combination of the specification used for <code>lme()</code> and <code>glm()</code>.</p>
<p><code>lm_imp()</code>, <code>glm_imp()</code> and <code>survreg_imp()</code> take arguments <code>formula</code> and <code>data</code>, whereas <code>lme_imp()</code> and <code>glme_imp()</code> require the specification of a <code>fixed</code> effects and a <code>random</code> effects formula. Specification of the fixed effects formula is demonstrated in section <a href="#ModelFormula">Model formula</a>, specification of the random effects in section <a href="#MultiLevelStructure">Multi level structure &amp; longitudinal covariates</a></p>
<p>Additionally, <code>glm_imp()</code> and <code>glme_imp()</code> require the specification of the model <a href="https://stat.ethz.ch/R-manual/R-devel/library/stats/html/family.html"><code>family</code></a> and <code>link</code> function.</p>
<div id="model-family-and-link-functions" class="section level3">
<h3>Model family and link functions</h3>
<p>Implemented families and links are</p>
<table>
<thead>
<tr class="header">
<th align="left">family</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>gaussian</code></td>
<td>with links: <code>identity</code>, <code>log</code></td>
</tr>
<tr class="even">
<td align="left"><code>binomial</code></td>
<td>with links: <code>logit</code>, <code>probit</code>, <code>log</code>, <code>cloglog</code></td>
</tr>
<tr class="odd">
<td align="left"><code>Gamma</code></td>
<td>with links: <code>identity</code>, <code>log</code></td>
</tr>
<tr class="even">
<td align="left"><code>poisson</code></td>
<td>with links: <code>log</code>, <code>identity</code></td>
</tr>
</tbody>
</table>
<p>The argument <code>family</code> can be given as character string or as function. If the link function is omitted, the <a href="https://stat.ethz.ch/R-manual/R-devel/library/stats/html/family.html">default link</a> is used.</p>
<p><strong>Example:</strong><br> The following three specifications are equal:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">mod1a &lt;-<span class="st"> </span><span class="kw">glm_imp</span>(educ <span class="op">~</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span>creat, <span class="dt">data =</span> NHANES,</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">               <span class="dt">family =</span> <span class="st">&quot;binomial&quot;</span>, <span class="dt">n.adapt =</span> <span class="dv">0</span>, <span class="dt">mess =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1-4" data-line-number="4">mod1b &lt;-<span class="st"> </span><span class="kw">glm_imp</span>(educ <span class="op">~</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span>creat, <span class="dt">data =</span> NHANES,</a>
<a class="sourceLine" id="cb1-5" data-line-number="5">               <span class="dt">family =</span> <span class="kw">binomial</span>(), <span class="dt">n.adapt =</span> <span class="dv">0</span>, <span class="dt">mess =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb1-6" data-line-number="6"></a>
<a class="sourceLine" id="cb1-7" data-line-number="7">mod1c &lt;-<span class="st"> </span><span class="kw">glm_imp</span>(educ <span class="op">~</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span>creat, <span class="dt">data =</span> NHANES,</a>
<a class="sourceLine" id="cb1-8" data-line-number="8">               <span class="dt">family =</span> <span class="kw">binomial</span>(<span class="dt">link =</span> <span class="st">'logit'</span>), <span class="dt">n.adapt =</span> <span class="dv">0</span>, <span class="dt">mess =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb1-9" data-line-number="9"></a>
<a class="sourceLine" id="cb1-10" data-line-number="10">mod1a<span class="op">$</span>analysis_type</a>
<a class="sourceLine" id="cb1-11" data-line-number="11"><span class="co">#&gt; [1] &quot;glm&quot;</span></a>
<a class="sourceLine" id="cb1-12" data-line-number="12"><span class="co">#&gt; attr(,&quot;family&quot;)</span></a>
<a class="sourceLine" id="cb1-13" data-line-number="13"><span class="co">#&gt; [1] &quot;binomial&quot;</span></a>
<a class="sourceLine" id="cb1-14" data-line-number="14"><span class="co">#&gt; attr(,&quot;link&quot;)</span></a>
<a class="sourceLine" id="cb1-15" data-line-number="15"><span class="co">#&gt; [1] &quot;logit&quot;</span></a></code></pre></div>
<p>To use a probit link instead, this needs to be specified explicitly:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">mod1d &lt;-<span class="st"> </span><span class="kw">glm_imp</span>(educ <span class="op">~</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span>creat, <span class="dt">data =</span> NHANES,</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">               <span class="dt">family =</span> <span class="kw">binomial</span>(<span class="dt">link =</span> <span class="st">'probit'</span>), <span class="dt">n.adapt =</span> <span class="dv">0</span>, <span class="dt">mess =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"></a>
<a class="sourceLine" id="cb2-4" data-line-number="4">mod1d<span class="op">$</span>analysis_type</a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="co">#&gt; [1] &quot;glm&quot;</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="co">#&gt; attr(,&quot;family&quot;)</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="co">#&gt; [1] &quot;binomial&quot;</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="co">#&gt; attr(,&quot;link&quot;)</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9"><span class="co">#&gt; [1] &quot;probit&quot;</span></a></code></pre></div>
</div>
</div>
<div id="ModelFormula" class="section level2">
<h2>Model formula</h2>
<p>The arguments <code>formula</code> (in <code>lm_imp()</code>, <code>glm_imp()</code> and <code>survreg_imp()</code>) and <code>fixed</code> (in <code>lme_imp()</code> and <code>glme_imp()</code>) take a two-sided <a href="https://stat.ethz.ch/R-manual/R-devel/library/stats/html/formula.html"><code>formula</code></a> object, where <code>~</code> separates the response (outcome / dependent variable) from the linear predictor, in which covariates (independent variables) are separated by <code>+</code>. An intercept is added automatically.</p>
<p><code>survreg_imp()</code> expects a <a href="https://stat.ethz.ch/R-manual/R-devel/library/survival/html/Surv.html">survival object (<code>Surv()</code>)</a> on the left hand side of the model formula. Currently, only right censored data can be handled.</p>
<div id="interactions" class="section level3">
<h3>Interactions</h3>
<p>Interactions between variables can be introduced using <code>:</code> or <code>*</code>, which adds the interaction term AND the main effects, i.e.,</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">SBP <span class="op">~</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span>smoke <span class="op">*</span><span class="st"> </span>creat</a></code></pre></div>
<p>is equivalent to</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">SBP <span class="op">~</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span>smoke <span class="op">+</span><span class="st"> </span>creat <span class="op">+</span><span class="st"> </span>smoke<span class="op">:</span>creat</a></code></pre></div>
<div id="interaction-with-multiple-variables" class="section level4">
<h4>Interaction with multiple variables</h4>
<p>Interactions between multiple variables can be specified using parentheses:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">mod2a &lt;-<span class="st"> </span><span class="kw">glm_imp</span>(educ <span class="op">~</span><span class="st"> </span>gender <span class="op">*</span><span class="st"> </span>(age <span class="op">+</span><span class="st"> </span>smoke <span class="op">+</span><span class="st"> </span>creat),</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">                 <span class="dt">data =</span> NHANES, <span class="dt">family =</span> <span class="kw">binomial</span>(), <span class="dt">mess =</span> <span class="ot">FALSE</span>, <span class="dt">n.adapt =</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb5-3" data-line-number="3"></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="kw">parameters</span>(mod2a, <span class="dt">mess =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="co">#&gt;  [1] &quot;(Intercept)&quot;               &quot;genderfemale&quot;              &quot;age&quot;                      </span></a>
<a class="sourceLine" id="cb5-6" data-line-number="6"><span class="co">#&gt;  [4] &quot;smokeformer&quot;               &quot;smokecurrent&quot;              &quot;creat&quot;                    </span></a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="co">#&gt;  [7] &quot;genderfemale:age&quot;          &quot;genderfemale:smokeformer&quot;  &quot;genderfemale:smokecurrent&quot;</span></a>
<a class="sourceLine" id="cb5-8" data-line-number="8"><span class="co">#&gt; [10] &quot;genderfemale:creat&quot;</span></a></code></pre></div>
<p>The function <a href="https://nerler.github.io/JointAI/reference/parameters.html"><code>parameters()</code></a> returns the parameters that are specified to be followed (even for models where no MCMC sampling was performed, i.e., when <code>n.iter = 0</code> and <code>n.adapt = 0</code>).</p>
</div>
<div id="higher-level-interactions" class="section level4">
<h4>Higher level interactions</h4>
<p>To specify interactions of a given level <code>^</code> can be used:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="co"># all two-way interactions:</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2">mod2b &lt;-<span class="st"> </span><span class="kw">glm_imp</span>(educ <span class="op">~</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span>(age <span class="op">+</span><span class="st"> </span>smoke <span class="op">+</span><span class="st"> </span>creat)<span class="op">^</span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">                 <span class="dt">data =</span> NHANES, <span class="dt">family =</span> <span class="kw">binomial</span>(), <span class="dt">mess =</span> <span class="ot">FALSE</span>, <span class="dt">n.adapt =</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb6-4" data-line-number="4"></a>
<a class="sourceLine" id="cb6-5" data-line-number="5"><span class="kw">parameters</span>(mod2b, <span class="dt">mess =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="co">#&gt;  [1] &quot;(Intercept)&quot;        &quot;genderfemale&quot;       &quot;age&quot;                &quot;smokeformer&quot;       </span></a>
<a class="sourceLine" id="cb6-7" data-line-number="7"><span class="co">#&gt;  [5] &quot;smokecurrent&quot;       &quot;creat&quot;              &quot;age:smokeformer&quot;    &quot;age:smokecurrent&quot;  </span></a>
<a class="sourceLine" id="cb6-8" data-line-number="8"><span class="co">#&gt;  [9] &quot;age:creat&quot;          &quot;smokeformer:creat&quot;  &quot;smokecurrent:creat&quot;</span></a>
<a class="sourceLine" id="cb6-9" data-line-number="9"></a>
<a class="sourceLine" id="cb6-10" data-line-number="10"><span class="co"># all two- and three-way interactions:</span></a>
<a class="sourceLine" id="cb6-11" data-line-number="11">mod2c &lt;-<span class="st"> </span><span class="kw">glm_imp</span>(educ <span class="op">~</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span>(age <span class="op">+</span><span class="st"> </span>smoke <span class="op">+</span><span class="st"> </span>creat)<span class="op">^</span><span class="dv">3</span>,</a>
<a class="sourceLine" id="cb6-12" data-line-number="12">                 <span class="dt">data =</span> NHANES, <span class="dt">family =</span> <span class="kw">binomial</span>(), <span class="dt">mess =</span> <span class="ot">FALSE</span>, <span class="dt">n.adapt =</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb6-13" data-line-number="13"></a>
<a class="sourceLine" id="cb6-14" data-line-number="14"><span class="kw">parameters</span>(mod2c, <span class="dt">mess =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb6-15" data-line-number="15"><span class="co">#&gt;  [1] &quot;(Intercept)&quot;            &quot;genderfemale&quot;           &quot;age&quot;                   </span></a>
<a class="sourceLine" id="cb6-16" data-line-number="16"><span class="co">#&gt;  [4] &quot;smokeformer&quot;            &quot;smokecurrent&quot;           &quot;creat&quot;                 </span></a>
<a class="sourceLine" id="cb6-17" data-line-number="17"><span class="co">#&gt;  [7] &quot;age:smokeformer&quot;        &quot;age:smokecurrent&quot;       &quot;age:creat&quot;             </span></a>
<a class="sourceLine" id="cb6-18" data-line-number="18"><span class="co">#&gt; [10] &quot;smokeformer:creat&quot;      &quot;smokecurrent:creat&quot;     &quot;age:smokeformer:creat&quot; </span></a>
<a class="sourceLine" id="cb6-19" data-line-number="19"><span class="co">#&gt; [13] &quot;age:smokecurrent:creat&quot;</span></a></code></pre></div>
<p>In <strong>JointAI</strong>, interactions between any type of variables (observed, incomplete, time-varying) are allowed. When an incomplete variable is involved, the interaction term is re-calculated within each iteration of the MCMC sampling, using the imputed values from the current iteration.</p>
</div>
</div>
<div id="non-linear-functional-forms" class="section level3">
<h3>Non-linear functional forms</h3>
<p>In practice, associations between outcome and covariates do not always meet the standard assumption that all covariate effects are linear. Often, assuming a logarithmic, quadratic or other non-linear effect is more appropriate.</p>
<p>Non-linear associations can be specified in the model formula using either functions such as <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/Log.html"><code>log()</code></a> (the natural logarithm), <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/MathFun.html"><code>sqrt()</code></a> (the square root) or <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/Log.html"><code>exp()</code></a> (the exponential function), or by specifying a function of a variable using <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/AsIs.html"><code>I()</code></a>, for example, <code>I(x^2)</code> would be the quadratic term of a variable <code>x</code>.</p>
<p>For <em>completely observed covariates</em>, <strong>JointAI</strong> can handle any common type of function implemented in R, including splines, e.g., using <a href="https://stat.ethz.ch/R-manual/R-devel/library/splines/html/ns.html"><code>ns()</code></a> or <a href="https://stat.ethz.ch/R-manual/R-devel/library/splines/html/bs.html"><code>bs()</code></a> from the package <strong>splines</strong> (which is automatically installed with R).</p>
<p>Since functions involving <em>variables that have missing values</em> need to be re-calculated in each iteration of the MCMC sampling, currently, only functions that are available in JAGS can be used for incomplete variables. Those functions include:</p>
<ul>
<li><code>log()</code>, <code>exp()</code></li>
<li><code>sqrt()</code>, polynomials (using <code>I()</code>)</li>
<li><code>abs()</code></li>
<li><code>sin()</code>, <code>cos()</code></li>
<li>algebraic operations involving one or multiple (in)complete variables, as long as the formula can be interpreted by JAGS</li>
</ul>
<p>The list of functions implemented in JAGS can be found in the <a href="https://sourceforge.net/projects/mcmc-jags/files/Manuals/">JAGS user manual</a>.</p>
<p><strong>Some examples:</strong><a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="co"># Absolute difference between bili and creat</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2">mod3a &lt;-<span class="st"> </span><span class="kw">lm_imp</span>(SBP <span class="op">~</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span><span class="kw">abs</span>(bili <span class="op">-</span><span class="st"> </span>creat),</a>
<a class="sourceLine" id="cb7-3" data-line-number="3">                <span class="dt">data =</span> NHANES, <span class="dt">mess =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb7-4" data-line-number="4"></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="co"># Using a natural cubic spline for age (completely observed) and a quadratic</span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="co"># and a cubic effect for bili</span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="kw">library</span>(splines)</a>
<a class="sourceLine" id="cb7-8" data-line-number="8">mod3b &lt;-<span class="st"> </span><span class="kw">lm_imp</span>(SBP <span class="op">~</span><span class="st"> </span><span class="kw">ns</span>(age, <span class="dt">df =</span> <span class="dv">2</span>) <span class="op">+</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(bili<span class="op">^</span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(bili<span class="op">^</span><span class="dv">3</span>),</a>
<a class="sourceLine" id="cb7-9" data-line-number="9">                <span class="dt">data =</span> NHANES, <span class="dt">mess =</span> <span class="ot">FALSE</span>, <span class="dt">keep_model =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb7-10" data-line-number="10"></a>
<a class="sourceLine" id="cb7-11" data-line-number="11"><span class="co"># A function of creat and albu</span></a>
<a class="sourceLine" id="cb7-12" data-line-number="12">mod3c &lt;-<span class="st"> </span><span class="kw">lm_imp</span>(SBP <span class="op">~</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(creat<span class="op">/</span>albu<span class="op">^</span><span class="dv">2</span>),</a>
<a class="sourceLine" id="cb7-13" data-line-number="13">                <span class="dt">data =</span> NHANES, <span class="dt">mess =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb7-14" data-line-number="14"><span class="co"># This function may make more sense to calculate BMI as weight/height^2, but</span></a>
<a class="sourceLine" id="cb7-15" data-line-number="15"><span class="co"># we do not have those variables in the NHANES data...</span></a>
<a class="sourceLine" id="cb7-16" data-line-number="16"></a>
<a class="sourceLine" id="cb7-17" data-line-number="17"><span class="co"># Using the sinus and cosinus</span></a>
<a class="sourceLine" id="cb7-18" data-line-number="18">mod3d &lt;-<span class="st"> </span><span class="kw">lm_imp</span>(SBP <span class="op">~</span><span class="st"> </span>bili <span class="op">+</span><span class="st"> </span><span class="kw">sin</span>(creat) <span class="op">+</span><span class="st"> </span><span class="kw">cos</span>(albu),</a>
<a class="sourceLine" id="cb7-19" data-line-number="19">                <span class="dt">data =</span> NHANES, <span class="dt">mess =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<div id="what-happens-inside-jointai" class="section level4">
<h4>What happens inside <strong>JointAI</strong>?</h4>
<p>When a function of a complete or incomplete variable is used in the model formula, the main effect of that variable is automatically added as auxiliary variable (more on auxiliary variables in section <a href="#auxvars">Auxiliary variables</a>), and only the main effects are used as predictors in models for incomplete variables.</p>
<p>In <code>mod3b</code>, for example, the spline of age is used as predictor for <code>SBP</code>, but in the imputation model for <code>bili</code>, <code>age</code> enters with a linear effect.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw">list_impmodels</span>(mod3b, <span class="dt">priors =</span> <span class="ot">FALSE</span>, <span class="dt">regcoef =</span> <span class="ot">FALSE</span>, <span class="dt">otherpars =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="co">#&gt; Normal imputation model for 'bili'</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="co">#&gt; * Predictor variables: </span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="co">#&gt;   (Intercept), genderfemale, age</span></a></code></pre></div>
<p>The function <a href="https://nerler.github.io/JointAI/reference/list_impmodels.html"><code>list_impmodels</code></a> prints a list of the imputation models used in a JointAI object. Since, at the moment, we are only interested in the predictor variables, we suppress printing of information on prior distributions, regression coefficients and other parameters by setting <code>priors</code>, <code>regcoev</code> and <code>otherpars</code> to <code>FALSE</code>.</p>
<p><br></p>
<p>When a function of a variable is specified as auxiliary variable, this function is used in the imputation models. For example, in <code>mod3e</code>, waist circumference (<code>WC</code>) is not part of the model for <code>SBP</code>, and <code>I(WC^2)</code> is used in the linear predictor of the imputation model for <code>bili</code>: <a id="mod3e"></a></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">mod3e &lt;-<span class="st"> </span><span class="kw">lm_imp</span>(SBP <span class="op">~</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span>bili, <span class="dt">auxvars =</span> <span class="st">&quot;I(WC^2)&quot;</span>,</a>
<a class="sourceLine" id="cb9-2" data-line-number="2">                <span class="dt">data =</span> NHANES, <span class="dt">mess =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb9-3" data-line-number="3"></a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="kw">list_impmodels</span>(mod3e, <span class="dt">priors =</span> F, <span class="dt">regcoef =</span> F, <span class="dt">otherpars =</span> F)</a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="co">#&gt; Normal imputation model for 'WC'</span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6"><span class="co">#&gt; * Predictor variables: </span></a>
<a class="sourceLine" id="cb9-7" data-line-number="7"><span class="co">#&gt;   (Intercept), age, genderfemale</span></a>
<a class="sourceLine" id="cb9-8" data-line-number="8"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb9-9" data-line-number="9"><span class="co">#&gt; Normal imputation model for 'bili'</span></a>
<a class="sourceLine" id="cb9-10" data-line-number="10"><span class="co">#&gt; * Predictor variables: </span></a>
<a class="sourceLine" id="cb9-11" data-line-number="11"><span class="co">#&gt;   (Intercept), age, genderfemale, I(WC^2)</span></a></code></pre></div>
<p>Incomplete variables are always imputed on their original scale, i.e.,</p>
<ul>
<li>in <code>mod3b</code> the variable <code>bili</code> is imputed and the quadratic and cubic versions calculated from the imputed values.</li>
<li>Likewise, <code>creat</code> and <code>albu</code> in <code>mod3c</code> are imputed separately, and <code>I(creat/albu^2)</code> calculated from the imputed (and observed) values.</li>
</ul>
<p>When different transformations of the same incomplete variable are used in one model, or interaction terms involve the main and interaction effect of an incomplete variable, it is strongly discouraged to calculate these transformations or interaction terms beforehand and supply them as different variables. If, for example, a model formula contains both <code>x</code> and <code>x2</code> (where <code>x2</code> = <code>x^2</code>), they are treated as separate variables and imputed with separate models. Imputed values of <code>x2</code> are thus not equal to the square of imputed values of <code>x</code>. Instead, <code>x + I(x^2)</code> should be used in the model formula. Then, only <code>x</code> is imputed and used in the linear predictor of models for other incomplete variables, and <code>x^2</code> is calculated from the imputed values of <code>x</code> internally.</p>
</div>
<div id="functions-with-restricted-support" class="section level4">
<h4>Functions with restricted support</h4>
<p>When a function has restricted support, e.g., <code>log(x)</code> is only defined for <code>x &gt; 0</code>, the distribution used to impute that variable needs to comply with these restrictions. This can either be achieved by truncating the distribution, using the argument <code>trunc</code>, or by selecting an imputation method that meets the restrictions. For more information on imputation methods, see the section <a href="#meth">Imputation model types</a>.</p>
<p><strong>Example</strong>:<br> When using a <code>log()</code> transformation for the covariate <code>bili</code>, we can either use the default imputation method <code>norm</code> (a normal distribution) and truncate it by specifying <code>trunc = list(bili = c(lower, upper))</code> (where the lower and upper limits are the smallest and largest allowed values) or choose an imputation method (using the argument <code>meth</code>; more details see the section on <a href="#meth">Imputation model types</a>) that only imputes positive values such as a log-normal distribution (<code>lognorm</code>) or a Gamma distribution (<code>gamma</code>): <a id="mod4"></a></p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="co"># truncation of the distribution of  bili</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2">mod4a &lt;-<span class="st"> </span><span class="kw">lm_imp</span>(SBP <span class="op">~</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span><span class="kw">log</span>(bili) <span class="op">+</span><span class="st"> </span><span class="kw">exp</span>(creat),</a>
<a class="sourceLine" id="cb10-3" data-line-number="3">                <span class="dt">trunc =</span> <span class="kw">list</span>(<span class="dt">bili =</span> <span class="kw">c</span>(<span class="fl">1e-5</span>, <span class="fl">1e10</span>)),</a>
<a class="sourceLine" id="cb10-4" data-line-number="4">                <span class="dt">data =</span> NHANES, <span class="dt">mess =</span> <span class="ot">FALSE</span>, <span class="dt">keep_model =</span> T)</a>
<a class="sourceLine" id="cb10-5" data-line-number="5"></a>
<a class="sourceLine" id="cb10-6" data-line-number="6"><span class="co"># log-normal model for bili</span></a>
<a class="sourceLine" id="cb10-7" data-line-number="7">mod4b &lt;-<span class="st"> </span><span class="kw">lm_imp</span>(SBP <span class="op">~</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span><span class="kw">log</span>(bili) <span class="op">+</span><span class="st"> </span><span class="kw">exp</span>(creat),</a>
<a class="sourceLine" id="cb10-8" data-line-number="8">                <span class="dt">meth =</span> <span class="kw">c</span>(<span class="dt">bili =</span> <span class="st">'lognorm'</span>, <span class="dt">creat =</span> <span class="st">'norm'</span>),</a>
<a class="sourceLine" id="cb10-9" data-line-number="9">                <span class="dt">data =</span> NHANES, <span class="dt">mess =</span> <span class="ot">FALSE</span>, <span class="dt">keep_model =</span> T)</a>
<a class="sourceLine" id="cb10-10" data-line-number="10"></a>
<a class="sourceLine" id="cb10-11" data-line-number="11"><span class="co"># gamma model for bili</span></a>
<a class="sourceLine" id="cb10-12" data-line-number="12">mod4c &lt;-<span class="st"> </span><span class="kw">lm_imp</span>(SBP <span class="op">~</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span><span class="kw">log</span>(bili) <span class="op">+</span><span class="st"> </span><span class="kw">exp</span>(creat),</a>
<a class="sourceLine" id="cb10-13" data-line-number="13">                <span class="dt">meth =</span> <span class="kw">c</span>(<span class="dt">bili =</span> <span class="st">'gamma'</span>, <span class="dt">creat =</span> <span class="st">'norm'</span>),</a>
<a class="sourceLine" id="cb10-14" data-line-number="14">                <span class="dt">data =</span> NHANES, <span class="dt">mess =</span> <span class="ot">FALSE</span>, <span class="dt">keep_model =</span> T)</a></code></pre></div>
<p>Truncation always requires to specify both limits. Since <code>-Inf</code> and <code>Inf</code> are not accepted, a value outside the range of the variable (here: 1e10) can be selected for the second boundary of the truncation interval.</p>
</div>
<div id="functions-that-are-not-available-in-r" class="section level4">
<h4>Functions that are not available in R</h4>
<p>It is possible to use functions that have different names in R and JAGS, or that do exist in JAGS, but not in R, by defining a new function in R that has the name of the function in JAGS.</p>
<p><strong>Example</strong>:<br> In JAGS the inverse logit transformation is defined in the function <code>ilogit</code>. In R, there is no function <code>ilogit</code>, but the inverse logit is available as the distribution function of the logistic distribution <code>plogis</code>.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="co"># Define the function ilogit</span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2">ilogit &lt;-<span class="st"> </span>plogis</a>
<a class="sourceLine" id="cb11-3" data-line-number="3"></a>
<a class="sourceLine" id="cb11-4" data-line-number="4"><span class="co"># Use ilogit in the model formula</span></a>
<a class="sourceLine" id="cb11-5" data-line-number="5">mod5a =<span class="st"> </span><span class="kw">lm_imp</span>(SBP <span class="op">~</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span><span class="kw">ilogit</span>(creat),</a>
<a class="sourceLine" id="cb11-6" data-line-number="6">               <span class="dt">data =</span> NHANES, <span class="dt">mess =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
</div>
<div id="nested-functions" class="section level4">
<h4>Nested functions</h4>
<p>It is also possible to nest a function in another function.</p>
<p><strong>Example:</strong><a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a></p>
<p>The complementary log log transformation is restricted to values larger than 0 and smaller than 1. In order to use this function on a variable that exceeds this range, as is the case for <code>creat</code>, a second transformation might be used, for instance the inverse logit from the previous example.</p>
<p>In JAGS, the complementary log log transformation is implemented as <code>cloglog</code>, but since this function does not exist in (base) R, we first need to define it:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="co"># define the complementary log log transformation</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2">cloglog &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">log</span>(<span class="op">-</span><span class="kw">log</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>x))</a>
<a class="sourceLine" id="cb12-3" data-line-number="3"></a>
<a class="sourceLine" id="cb12-4" data-line-number="4"><span class="co"># define the inverse logit (in case you have not done it in the previous example)</span></a>
<a class="sourceLine" id="cb12-5" data-line-number="5">ilogit &lt;-<span class="st"> </span>plogis</a>
<a class="sourceLine" id="cb12-6" data-line-number="6"></a>
<a class="sourceLine" id="cb12-7" data-line-number="7"><span class="co"># nest ilogit inside cloglog</span></a>
<a class="sourceLine" id="cb12-8" data-line-number="8">mod6a =<span class="st"> </span><span class="kw">lm_imp</span>(SBP <span class="op">~</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span><span class="kw">cloglog</span>(<span class="kw">ilogit</span>(creat)),</a>
<a class="sourceLine" id="cb12-9" data-line-number="9">               <span class="dt">data =</span> NHANES, <span class="dt">mess =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
</div>
</div>
</div>
<div id="MultiLevelStructure" class="section level2">
<h2>Multi level structure &amp; longitudinal covariates</h2>
<p>In multi-level models, additional to the fixed effects structure specified by the argument <code>fixed</code> a random effects structure needs to be provided via the argument <code>random</code>.</p>
<div id="random-effects" class="section level3">
<h3>Random effects</h3>
<p><code>random</code> takes a one-sided formula starting with a <code>~</code>. Variables for which a random effect should be included are usually separated by a <code>+</code>, and the grouping variable is separated by <code>|</code>. A random intercept is added automatically and only needs to be specified in a random intercept only model.</p>
<p>A few examples:</p>
<ul>
<li><code>random = ~1|id</code>: random intercept only, with <code>id</code> as grouping variable</li>
<li><code>random = ~time|id</code>: random intercept and slope for variable <code>time</code></li>
<li><code>random = ~time + I(time^2)</code>: random intercept, slope and quadratic random effect for <code>time</code></li>
<li><code>random = ~time + x | id</code> random intercept, random slope for <code>time</code> and random effect for variable <code>x</code></li>
</ul>
<p>It is possible to use splines in the random effects structure, e.g.:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">mod7a &lt;-<span class="st"> </span><span class="kw">lme_imp</span>(bmi <span class="op">~</span><span class="st"> </span>GESTBIR <span class="op">+</span><span class="st"> </span>ETHN <span class="op">+</span><span class="st"> </span>HEIGHT_M <span class="op">+</span><span class="st"> </span><span class="kw">ns</span>(age, <span class="dt">df =</span> <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb13-2" data-line-number="2">                 <span class="dt">random =</span> <span class="op">~</span><span class="kw">ns</span>(age, <span class="dt">df =</span> <span class="dv">2</span>)<span class="op">|</span>ID, </a>
<a class="sourceLine" id="cb13-3" data-line-number="3">                 <span class="dt">data =</span> simLong, <span class="dt">mess =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<p>Currently, multiple levels of nesting (nested or crossed random effects) are not yet available.</p>
</div>
<div id="longitudinal-covariates" class="section level3">
<h3>Longitudinal covariates</h3>
<p>Longitudinal (“time-varying”) covariates can be used in the model, however, they can not yet be imputed.</p>
</div>
</div>
<div id="meth" class="section level2">
<h2>Imputation model types</h2>
<p><strong>JointAI</strong> automatically selects an imputation model for each of the incomplete variables, based on the <code>class</code> of the variable and the number of levels. The automatically selected types are:</p>
<table>
<thead>
<tr class="header">
<th align="left">name</th>
<th align="left">model</th>
<th align="left">variable type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>norm</code></td>
<td align="left">linear regression</td>
<td align="left">continuous variables</td>
</tr>
<tr class="even">
<td align="left"><code>logit</code></td>
<td align="left">logistic regression</td>
<td align="left">factors with two levels</td>
</tr>
<tr class="odd">
<td align="left"><code>multilogit</code></td>
<td align="left">multinomial logit model</td>
<td align="left">unordered factors with &gt;2 levels</td>
</tr>
<tr class="even">
<td align="left"><code>cumlogit</code></td>
<td align="left">cumulative logit model</td>
<td align="left">ordered factors with &gt;2 levels</td>
</tr>
</tbody>
</table>
<p>The imputation models that are chosen by default may not necessarily be appropriate for the data at hand, especially for continuous variables, which often do not comply with the assumptions of (conditional) normality.</p>
<p>Therefore, alternative imputation methods are available for continuous covariates:</p>
<table>
<thead>
<tr class="header">
<th align="left">name</th>
<th align="left">model</th>
<th align="left">variable type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>lognorm</code></td>
<td align="left">normal regression of the log-transformed variable</td>
<td align="left">right-skewed variables &gt;0</td>
</tr>
<tr class="even">
<td align="left"><code>gamma</code></td>
<td align="left">Gamma regression (with log-link)</td>
<td align="left">right-skewed variables &gt;0</td>
</tr>
<tr class="odd">
<td align="left"><code>beta</code></td>
<td align="left">beta regression (with logit-link)</td>
<td align="left">continuous variables with values in [0, 1]</td>
</tr>
</tbody>
</table>
<p><code>lognorm</code> assumes a normal distribution for the natural logarithm of the variable, but the variable enters the linear predictor of the analysis model (and possibly other imputation models) on its original scale.</p>
<div id="specification-of-imputation-model-types" class="section level3">
<h3>Specification of imputation model types</h3>
<p>In models <a href="#mod4"><code>mod4b</code> and <code>mod4c</code></a> we have already seen two examples in which the imputation model type was changed using the argument <code>meth</code>.</p>
<p><code>meth</code> takes a named vector of imputation model types, where the names are the names of the incomplete variables. When the vector supplied to meth only contains specifications for a subset of the incomplete variables, default models are used for the remaining incomplete variables.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">mod8a &lt;-<span class="st"> </span><span class="kw">lm_imp</span>(SBP <span class="op">~</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span>WC <span class="op">+</span><span class="st"> </span>alc <span class="op">+</span><span class="st"> </span>bili <span class="op">+</span><span class="st"> </span>occup <span class="op">+</span><span class="st"> </span>smoke,</a>
<a class="sourceLine" id="cb14-2" data-line-number="2">                <span class="dt">meth =</span> <span class="kw">c</span>(<span class="dt">bili =</span> <span class="st">'gamma'</span>, <span class="dt">WC =</span> <span class="st">'lognorm'</span>),</a>
<a class="sourceLine" id="cb14-3" data-line-number="3">                <span class="dt">data =</span> NHANES, <span class="dt">n.iter =</span> <span class="dv">100</span>, <span class="dt">mess =</span> <span class="ot">FALSE</span>, <span class="dt">progress.bar =</span> <span class="st">'none'</span>)</a>
<a class="sourceLine" id="cb14-4" data-line-number="4"></a>
<a class="sourceLine" id="cb14-5" data-line-number="5">mod8a<span class="op">$</span>meth</a>
<a class="sourceLine" id="cb14-6" data-line-number="6"><span class="co">#&gt;           WC        smoke         bili        occup          alc </span></a>
<a class="sourceLine" id="cb14-7" data-line-number="7"><span class="co">#&gt;    &quot;lognorm&quot;   &quot;cumlogit&quot;      &quot;gamma&quot; &quot;multilogit&quot;      &quot;logit&quot;</span></a></code></pre></div>
<p>The function <a href="https://nerler.github.io/JointAI/reference/get_imp_meth.html"><code>get_imp_meth()</code></a>, which finds and assigns the default imputation methods, can be called directly. <code>get_imp_meth</code> has arguments</p>
<ul>
<li><code>fixed</code>: the fixed effects formula</li>
<li><code>random</code>: the random effects formula (if necessary)</li>
<li><code>data</code>: the dataset</li>
<li><code>auxvars</code>: an optional vector of auxiliary variables.</li>
</ul>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">mod8a_meth &lt;-<span class="st"> </span><span class="kw">get_imp_meth</span>(SBP <span class="op">~</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span>WC <span class="op">+</span><span class="st"> </span>alc <span class="op">+</span><span class="st"> </span>bili <span class="op">+</span><span class="st"> </span>occup <span class="op">+</span><span class="st"> </span>smoke,</a>
<a class="sourceLine" id="cb15-2" data-line-number="2">                           <span class="dt">data =</span> NHANES)</a>
<a class="sourceLine" id="cb15-3" data-line-number="3">mod8a_meth</a>
<a class="sourceLine" id="cb15-4" data-line-number="4"><span class="co">#&gt;           WC        smoke         bili        occup          alc </span></a>
<a class="sourceLine" id="cb15-5" data-line-number="5"><span class="co">#&gt;       &quot;norm&quot;   &quot;cumlogit&quot;       &quot;norm&quot; &quot;multilogit&quot;      &quot;logit&quot;</span></a></code></pre></div>
<p>When a continuous incomplete variable has only two different values it is assumed to be binary and its coding and default imputation model will be changed accordingly. This behavior can be overwritten when the imputation method for that variable is specified directly by the user.</p>
<p>Variables of type <code>logical</code> are automatically converted to unordered factors.</p>
</div>
<div id="order-of-the-sequence-of-imputation-models" class="section level3">
<h3>Order of the sequence of imputation models</h3>
<p>By default, the imputation models are ordered by number of missing values (decreasing), and each model has the (cross-sectional) complete covariates and all incomplete variables that appear earlier in the sequence in its linear predictor:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="co"># number of missing values in the covariates in mod8a</span></a>
<a class="sourceLine" id="cb16-2" data-line-number="2"><span class="kw">colSums</span>(<span class="kw">is.na</span>(NHANES[, <span class="kw">names</span>(mod8a_meth)]))</a>
<a class="sourceLine" id="cb16-3" data-line-number="3"><span class="co">#&gt;    WC smoke  bili occup   alc </span></a>
<a class="sourceLine" id="cb16-4" data-line-number="4"><span class="co">#&gt;     2     7     8    28    34</span></a>
<a class="sourceLine" id="cb16-5" data-line-number="5"></a>
<a class="sourceLine" id="cb16-6" data-line-number="6"><span class="co"># print information on the imputation models (and omit everything but the predictor variables)</span></a>
<a class="sourceLine" id="cb16-7" data-line-number="7"><span class="kw">list_impmodels</span>(mod8a, <span class="dt">priors =</span> F, <span class="dt">regcoef =</span> F, <span class="dt">otherpars =</span> F, <span class="dt">refcat =</span> F)</a>
<a class="sourceLine" id="cb16-8" data-line-number="8"><span class="co">#&gt; Log-normal imputation model for 'WC'</span></a>
<a class="sourceLine" id="cb16-9" data-line-number="9"><span class="co">#&gt; * Predictor variables: </span></a>
<a class="sourceLine" id="cb16-10" data-line-number="10"><span class="co">#&gt;   (Intercept), age, genderfemale</span></a>
<a class="sourceLine" id="cb16-11" data-line-number="11"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb16-12" data-line-number="12"><span class="co">#&gt; Cumulative logit imputation model for 'smoke'</span></a>
<a class="sourceLine" id="cb16-13" data-line-number="13"><span class="co">#&gt; * Predictor variables: </span></a>
<a class="sourceLine" id="cb16-14" data-line-number="14"><span class="co">#&gt;   age, genderfemale, WC</span></a>
<a class="sourceLine" id="cb16-15" data-line-number="15"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb16-16" data-line-number="16"><span class="co">#&gt; Gamma imputation model for 'bili'</span></a>
<a class="sourceLine" id="cb16-17" data-line-number="17"><span class="co">#&gt; * Parametrization:</span></a>
<a class="sourceLine" id="cb16-18" data-line-number="18"><span class="co">#&gt;   - shape: shape_bili = mu_bili^2 * tau_bili</span></a>
<a class="sourceLine" id="cb16-19" data-line-number="19"><span class="co">#&gt;   - rate: rate_bili = mu_bili * tau_bili</span></a>
<a class="sourceLine" id="cb16-20" data-line-number="20"><span class="co">#&gt; * Predictor variables: </span></a>
<a class="sourceLine" id="cb16-21" data-line-number="21"><span class="co">#&gt;   (Intercept), age, genderfemale, WC, smokeformer, smokecurrent</span></a>
<a class="sourceLine" id="cb16-22" data-line-number="22"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb16-23" data-line-number="23"><span class="co">#&gt; Multinomial logit imputation model for 'occup'</span></a>
<a class="sourceLine" id="cb16-24" data-line-number="24"><span class="co">#&gt; * Predictor variables: </span></a>
<a class="sourceLine" id="cb16-25" data-line-number="25"><span class="co">#&gt;   (Intercept), age, genderfemale, WC, smokeformer, smokecurrent, bili</span></a>
<a class="sourceLine" id="cb16-26" data-line-number="26"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb16-27" data-line-number="27"><span class="co">#&gt; Logistic imputation model for 'alc'</span></a>
<a class="sourceLine" id="cb16-28" data-line-number="28"><span class="co">#&gt; * Predictor variables: </span></a>
<a class="sourceLine" id="cb16-29" data-line-number="29"><span class="co">#&gt;   (Intercept), age, genderfemale, WC, smokeformer, smokecurrent, bili, occuplooking for work, occupnot working</span></a></code></pre></div>
<p>By re-ordering the elements in <code>meth</code>, the order of the sequence of imputation models will be changed. Note that this requires the user to specify imputation methods for all incomplete variables; when only a subset is specified the default order will be retained.</p>
</div>
</div>
<div id="auxvars" class="section level2">
<h2>Auxiliary variables</h2>
<p>Auxiliary variables are variables that are not part of the analysis model, but should be considered as predictor variables in the imputation models because they can inform the imputation of on unobserved values.</p>
<p>Good auxiliary variables are</p>
<ul>
<li>associated with an incomplete variable of interest, or are</li>
<li>associated with the missingness of that variable and</li>
<li>do not have too many missing values themselves. Importantly, they should be observed for a large proportion of the cases that have a missing value in the variable to be imputed.</li>
</ul>
<p>In <code>lm_imp()</code>, <code>glm_imp()</code>, <code>lme_imp()</code>, <code>glme_imp()</code> and <code>survreg_imp()</code> auxiliary variables can be specified with the argument <code>auxvars</code>, which is a vector containing the names of the auxiliary variables.</p>
<p><strong>Example:</strong><br> We might consider the variables <code>educ</code> and <code>smoke</code> as predictors for the imputation of <code>occup</code>:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">mod9a &lt;-<span class="st"> </span><span class="kw">lm_imp</span>(SBP <span class="op">~</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>occup, <span class="dt">auxvars =</span> <span class="kw">c</span>(<span class="st">'educ'</span>, <span class="st">'smoke'</span>),</a>
<a class="sourceLine" id="cb17-2" data-line-number="2">                <span class="dt">data =</span> NHANES, <span class="dt">n.iter =</span> <span class="dv">100</span>, <span class="dt">progress.bar =</span> <span class="st">'none'</span>, <span class="dt">mess =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<p>The regression coefficients for <code>educ</code> and <code>smoke</code> in the analysis model are fixed to zero so that these two variables do not contribute to the model, and are omitted from the model summary:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="kw">summary</span>(mod9a)</a>
<a class="sourceLine" id="cb18-2" data-line-number="2"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb18-3" data-line-number="3"><span class="co">#&gt;  Linear model fitted with JointAI </span></a>
<a class="sourceLine" id="cb18-4" data-line-number="4"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb18-5" data-line-number="5"><span class="co">#&gt; Call:</span></a>
<a class="sourceLine" id="cb18-6" data-line-number="6"><span class="co">#&gt; lm_imp(formula = SBP ~ gender + age + occup, data = NHANES, n.iter = 100, </span></a>
<a class="sourceLine" id="cb18-7" data-line-number="7"><span class="co">#&gt;     progress.bar = &quot;none&quot;, mess = FALSE, auxvars = c(&quot;educ&quot;, </span></a>
<a class="sourceLine" id="cb18-8" data-line-number="8"><span class="co">#&gt;         &quot;smoke&quot;))</span></a>
<a class="sourceLine" id="cb18-9" data-line-number="9"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb18-10" data-line-number="10"><span class="co">#&gt; Posterior summary:</span></a>
<a class="sourceLine" id="cb18-11" data-line-number="11"><span class="co">#&gt;                          Mean     SD   2.5%  97.5% tail-prob. GR-crit</span></a>
<a class="sourceLine" id="cb18-12" data-line-number="12"><span class="co">#&gt; (Intercept)           105.652 3.1267 99.832 111.65    0.00000    1.00</span></a>
<a class="sourceLine" id="cb18-13" data-line-number="13"><span class="co">#&gt; genderfemale           -5.624 2.1182 -9.778  -1.65    0.00667    1.02</span></a>
<a class="sourceLine" id="cb18-14" data-line-number="14"><span class="co">#&gt; age                     0.373 0.0733  0.228   0.51    0.00000    1.05</span></a>
<a class="sourceLine" id="cb18-15" data-line-number="15"><span class="co">#&gt; occuplooking for work   4.082 5.9771 -7.727  15.89    0.53333    1.03</span></a>
<a class="sourceLine" id="cb18-16" data-line-number="16"><span class="co">#&gt; occupnot working       -0.347 2.6793 -5.574   4.93    0.96000    1.07</span></a>
<a class="sourceLine" id="cb18-17" data-line-number="17"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb18-18" data-line-number="18"><span class="co">#&gt; Posterior summary of residual std. deviation:</span></a>
<a class="sourceLine" id="cb18-19" data-line-number="19"><span class="co">#&gt;           Mean    SD 2.5% 97.5% GR-crit</span></a>
<a class="sourceLine" id="cb18-20" data-line-number="20"><span class="co">#&gt; sigma_SBP 14.4 0.742 13.1  15.9    1.01</span></a>
<a class="sourceLine" id="cb18-21" data-line-number="21"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb18-22" data-line-number="22"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb18-23" data-line-number="23"><span class="co">#&gt; MCMC settings:</span></a>
<a class="sourceLine" id="cb18-24" data-line-number="24"><span class="co">#&gt; Iterations = 101:200</span></a>
<a class="sourceLine" id="cb18-25" data-line-number="25"><span class="co">#&gt; Sample size per chain = 100 </span></a>
<a class="sourceLine" id="cb18-26" data-line-number="26"><span class="co">#&gt; Thinning interval = 1 </span></a>
<a class="sourceLine" id="cb18-27" data-line-number="27"><span class="co">#&gt; Number of chains = 3 </span></a>
<a class="sourceLine" id="cb18-28" data-line-number="28"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb18-29" data-line-number="29"><span class="co">#&gt; Number of observations: 186</span></a></code></pre></div>
<p>They are, however, used as predictors in the imputation for <code>occup</code> and imputed themselves (if they have missing values):</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="kw">list_impmodels</span>(mod9a, <span class="dt">priors =</span> <span class="ot">FALSE</span>, <span class="dt">regcoef =</span> <span class="ot">FALSE</span>, <span class="dt">otherpars =</span> <span class="ot">FALSE</span>, <span class="dt">refcat =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb19-2" data-line-number="2"><span class="co">#&gt; Cumulative logit imputation model for 'smoke'</span></a>
<a class="sourceLine" id="cb19-3" data-line-number="3"><span class="co">#&gt; * Predictor variables: </span></a>
<a class="sourceLine" id="cb19-4" data-line-number="4"><span class="co">#&gt;   genderfemale, age, educhigh</span></a>
<a class="sourceLine" id="cb19-5" data-line-number="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb19-6" data-line-number="6"><span class="co">#&gt; Multinomial logit imputation model for 'occup'</span></a>
<a class="sourceLine" id="cb19-7" data-line-number="7"><span class="co">#&gt; * Predictor variables: </span></a>
<a class="sourceLine" id="cb19-8" data-line-number="8"><span class="co">#&gt;   (Intercept), genderfemale, age, educhigh, smokeformer, smokecurrent</span></a></code></pre></div>
<div id="functions-of-variables-as-auxiliary-variables" class="section level3">
<h3>Functions of variables as auxiliary variables</h3>
<p>As shown above in <a href="#mod3e"><code>mod3e</code></a>, it is possible to specify functions of auxiliary variables. In that case, the auxiliary variable is not considered as linear effect but as specified by the function:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1">mod9b &lt;-<span class="st"> </span><span class="kw">lm_imp</span>(SBP <span class="op">~</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>occup, <span class="dt">data =</span> NHANES,</a>
<a class="sourceLine" id="cb20-2" data-line-number="2">                <span class="dt">auxvars =</span> <span class="kw">c</span>(<span class="st">'educ'</span>, <span class="st">'smoke'</span>, <span class="st">'log(WC)'</span>),</a>
<a class="sourceLine" id="cb20-3" data-line-number="3">                <span class="dt">trunc =</span> <span class="kw">list</span>(<span class="dt">WC =</span> <span class="kw">c</span>(<span class="fl">1e-10</span>, <span class="fl">1e10</span>)), <span class="dt">n.adapt =</span> <span class="dv">0</span>, <span class="dt">mess =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="kw">list_impmodels</span>(mod9b, <span class="dt">priors =</span> <span class="ot">FALSE</span>, <span class="dt">regcoef =</span> <span class="ot">FALSE</span>, <span class="dt">otherpars =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb21-2" data-line-number="2">               <span class="dt">refcat =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb21-3" data-line-number="3"><span class="co">#&gt; Normal imputation model for 'WC'</span></a>
<a class="sourceLine" id="cb21-4" data-line-number="4"><span class="co">#&gt; * Predictor variables: </span></a>
<a class="sourceLine" id="cb21-5" data-line-number="5"><span class="co">#&gt;   (Intercept), genderfemale, age, educhigh</span></a>
<a class="sourceLine" id="cb21-6" data-line-number="6"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb21-7" data-line-number="7"><span class="co">#&gt; Cumulative logit imputation model for 'smoke'</span></a>
<a class="sourceLine" id="cb21-8" data-line-number="8"><span class="co">#&gt; * Predictor variables: </span></a>
<a class="sourceLine" id="cb21-9" data-line-number="9"><span class="co">#&gt;   genderfemale, age, educhigh, log(WC)</span></a>
<a class="sourceLine" id="cb21-10" data-line-number="10"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb21-11" data-line-number="11"><span class="co">#&gt; Multinomial logit imputation model for 'occup'</span></a>
<a class="sourceLine" id="cb21-12" data-line-number="12"><span class="co">#&gt; * Predictor variables: </span></a>
<a class="sourceLine" id="cb21-13" data-line-number="13"><span class="co">#&gt;   (Intercept), genderfemale, age, educhigh, log(WC), smokeformer, smokecurrent</span></a></code></pre></div>
</div>
<div id="note" class="section level3">
<h3>Note:</h3>
<p>Setting the regression coefficient of auxiliary variables to zero in the analysis model implies that the outcome is independent of these variables, conditional on the other variables in the model. If this is not true, the model is mis-specified which may lead to biased results (similar to leaving an confounding variable out of a model).</p>
</div>
</div>
<div id="reference-values-for-categorical-covariates" class="section level2">
<h2>Reference values for categorical covariates</h2>
<p>In <strong>JointAI</strong> dummy coding is used when categorical variables enter a linear predictor, i.e., a binary variables is created for each category, except the reference category. These binary variables have value one when that category was observed and zero otherwise.</p>
<p>By default, the first category of a categorical variable (ordered or unordered) is used as reference, however, this may not always allow the desired interpretation of the regression coefficients. Moreover, when categories are unbalanced, setting the largest group as reference may result in better mixing of the MCMC chains.</p>
<p>Therefore, <strong>JointAI</strong> allows specification of the reference category separately for each variable, via the argument <code>refcats</code>.</p>
<div id="setting-reference-categories-for-all-variables" class="section level3">
<h3>Setting reference categories for all variables</h3>
<p>To specify the choice of reference category globally for all variables in the model, <code>refcats</code> can be set as</p>
<ul>
<li><code>refcats = &quot;first&quot;</code></li>
<li><code>refcats = &quot;last&quot;</code></li>
<li><code>refcats = &quot;largest&quot;</code></li>
</ul>
<p>For example:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1">mod10a &lt;-<span class="st"> </span><span class="kw">lm_imp</span>(SBP <span class="op">~</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>race <span class="op">+</span><span class="st"> </span>educ <span class="op">+</span><span class="st"> </span>occup <span class="op">+</span><span class="st"> </span>smoke,</a>
<a class="sourceLine" id="cb22-2" data-line-number="2">                 <span class="dt">refcats =</span> <span class="st">&quot;largest&quot;</span>,</a>
<a class="sourceLine" id="cb22-3" data-line-number="3">                 <span class="dt">data =</span> NHANES, <span class="dt">n.adapt =</span> <span class="dv">0</span>, <span class="dt">mess =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
</div>
<div id="setting-reference-categories-for-individual-variables" class="section level3">
<h3>Setting reference categories for individual variables</h3>
<p>Alternatively, <code>refcats</code> takes a named vector, in which the reference category for each variable can be specified either by its number or its name, or one of the three global types: “first”, “last” or “largest”. For variables for which no reference category is specified in the list the default is used.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1">mod10b &lt;-<span class="st"> </span><span class="kw">lm_imp</span>(SBP <span class="op">~</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>race <span class="op">+</span><span class="st"> </span>educ <span class="op">+</span><span class="st"> </span>occup <span class="op">+</span><span class="st"> </span>smoke,</a>
<a class="sourceLine" id="cb23-2" data-line-number="2">                 <span class="dt">refcats =</span> <span class="kw">list</span>(<span class="dt">occup =</span> <span class="st">&quot;not working&quot;</span>, <span class="dt">race =</span> <span class="dv">3</span>, <span class="dt">educ =</span> <span class="st">'largest'</span>),</a>
<a class="sourceLine" id="cb23-3" data-line-number="3">                 <span class="dt">data =</span> NHANES, <span class="dt">n.adapt =</span> <span class="dv">0</span>, <span class="dt">mess =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<p>To help to specify the reference category, the function <a href="https://nerler.github.io/JointAI/reference/set_refcat.html"><code>set_refcat()</code></a> can be used. It prints the names of the categorical variables that are selected by</p>
<ul>
<li>a specified model formula and/or</li>
<li>a vector of auxiliary variables, or</li>
<li>a vector of naming covariates</li>
</ul>
<p>or all categorical variables in the data if only <code>data</code> is provided, and asks a number of questions which the user needs to reply to by input of a number.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1">refs_mod10 &lt;-<span class="st"> </span><span class="kw">set_refcat</span>(NHANES, <span class="dt">formula =</span> <span class="kw">formula</span>(mod10b))</a>
<a class="sourceLine" id="cb24-2" data-line-number="2"><span class="co">#&gt; The categorical variables are:</span></a>
<a class="sourceLine" id="cb24-3" data-line-number="3"><span class="co">#&gt; - &quot;gender&quot;</span></a>
<a class="sourceLine" id="cb24-4" data-line-number="4"><span class="co">#&gt; - &quot;race&quot;</span></a>
<a class="sourceLine" id="cb24-5" data-line-number="5"><span class="co">#&gt; - &quot;educ&quot;</span></a>
<a class="sourceLine" id="cb24-6" data-line-number="6"><span class="co">#&gt; - &quot;occup&quot;</span></a>
<a class="sourceLine" id="cb24-7" data-line-number="7"><span class="co">#&gt; - &quot;smoke&quot;</span></a>
<a class="sourceLine" id="cb24-8" data-line-number="8"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb24-9" data-line-number="9"><span class="co">#&gt; How do you want to specify the reference categories?</span></a>
<a class="sourceLine" id="cb24-10" data-line-number="10"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb24-11" data-line-number="11"><span class="co">#&gt; 1: Use the first category for each variable.</span></a>
<a class="sourceLine" id="cb24-12" data-line-number="12"><span class="co">#&gt; 2: Use the last category for each variabe.</span></a>
<a class="sourceLine" id="cb24-13" data-line-number="13"><span class="co">#&gt; 3: Use the largest category for each variable.</span></a>
<a class="sourceLine" id="cb24-14" data-line-number="14"><span class="co">#&gt; 4: Specify the reference categories individually.</span></a></code></pre></div>
<p>When option 4 is chosen, a question for each categorical variable is asked, for example:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1"><span class="co">#&gt; The reference category for “race” should be </span></a>
<a class="sourceLine" id="cb25-2" data-line-number="2"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb25-3" data-line-number="3"><span class="co">#&gt; 1: Mexican American</span></a>
<a class="sourceLine" id="cb25-4" data-line-number="4"><span class="co">#&gt; 2: Other Hispanic</span></a>
<a class="sourceLine" id="cb25-5" data-line-number="5"><span class="co">#&gt; 3: Non-Hispanic White</span></a>
<a class="sourceLine" id="cb25-6" data-line-number="6"><span class="co">#&gt; 4: Non-Hispanic Black</span></a>
<a class="sourceLine" id="cb25-7" data-line-number="7"><span class="co">#&gt; 5: other</span></a></code></pre></div>
<p>After specification of the reference categories for all categorical variables, the determined specification for the argument <code>refcats</code> is printed:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1"><span class="co">#&gt; In the JointAI model specify:</span></a>
<a class="sourceLine" id="cb26-2" data-line-number="2"><span class="co">#&gt;  refcats = c(gender = 'female', race = 'Non-Hispanic White', educ = 'low',</span></a>
<a class="sourceLine" id="cb26-3" data-line-number="3"><span class="co">#&gt;              occup = 'not working', smoke = 'never')</span></a>
<a class="sourceLine" id="cb26-4" data-line-number="4"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb26-5" data-line-number="5"><span class="co">#&gt; or use the output of this function.</span></a></code></pre></div>
<p><code>set_refcat()</code> also returns a named vector that can be passed to the argument <code>refcats</code>:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1">mod10c &lt;-<span class="st"> </span><span class="kw">lm_imp</span>(SBP <span class="op">~</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>race <span class="op">+</span><span class="st"> </span>educ <span class="op">+</span><span class="st"> </span>occup <span class="op">+</span><span class="st"> </span>smoke,</a>
<a class="sourceLine" id="cb27-2" data-line-number="2">                 <span class="dt">refcats =</span> refs_mod10,</a>
<a class="sourceLine" id="cb27-3" data-line-number="3">                 <span class="dt">data =</span> NHANES, <span class="dt">n.adapt =</span> <span class="dv">0</span>, <span class="dt">mess =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
</div>
<div id="some-notes" class="section level3">
<h3>Some notes</h3>
<p>Contrary to base R behavior, dummy coding (i.e., <code>contr.treatment</code> contrasts) are used for ordered factors in any linear predictor. Since the order of levels in an ordered factor contains information relevant to the imputation of missing values, it is important that incomplete ordinal variables are coded as such.</p>
<p>For unordered factors, the reference category could be changed in the dataset directly, outside of <strong>JointAI</strong>, e.g., using <a href="https://stat.ethz.ch/R-manual/R-patched/library/stats/html/relevel.html"><code>relevel()</code></a>. For ordered factors, however, this is not possible without loosing or changing the order of the levels. In this case, the <code>refcats</code> argument in <strong>JointAI</strong> has to be used.</p>
<p>Changing a reference category via the argument <code>refcats</code> does not change the order of levels in the dataset or any of the data matrices inside <strong>JointAI</strong>. Only when, in the JAGS model, the categorical variables is converted into dummy variables, the reference category is used to determine for which levels the dummies are created.</p>
</div>
</div>
<div id="hyperparameters" class="section level2">
<h2>Hyperparameters</h2>
<p>In the Bayesian framework, parameters are random variables for which a distribution needs to be specified. These distributions depend on parameters themselves, i.e., on hyperparameters.</p>
<p>The function <code>default_hyperpars()</code> returns a list containing the default hyper parameters used in a <code>JointAI</code> model. Arguments <code>family</code>, <code>link</code> and <code>nranef</code> allow to specify a model family and link, as well as the number of random effects.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1"><span class="kw">default_hyperpars</span>(<span class="dt">nranef =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb28-2" data-line-number="2"><span class="co">#&gt; $analysis_model</span></a>
<a class="sourceLine" id="cb28-3" data-line-number="3"><span class="co">#&gt;  mu_reg_main tau_reg_main   a_tau_main   b_tau_main </span></a>
<a class="sourceLine" id="cb28-4" data-line-number="4"><span class="co">#&gt;        0e+00        1e-04        1e-02        1e-03 </span></a>
<a class="sourceLine" id="cb28-5" data-line-number="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb28-6" data-line-number="6"><span class="co">#&gt; $Z</span></a>
<a class="sourceLine" id="cb28-7" data-line-number="7"><span class="co">#&gt; $Z$RinvD</span></a>
<a class="sourceLine" id="cb28-8" data-line-number="8"><span class="co">#&gt;      [,1] [,2]</span></a>
<a class="sourceLine" id="cb28-9" data-line-number="9"><span class="co">#&gt; [1,]   NA    0</span></a>
<a class="sourceLine" id="cb28-10" data-line-number="10"><span class="co">#&gt; [2,]    0   NA</span></a>
<a class="sourceLine" id="cb28-11" data-line-number="11"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb28-12" data-line-number="12"><span class="co">#&gt; $Z$KinvD</span></a>
<a class="sourceLine" id="cb28-13" data-line-number="13"><span class="co">#&gt; [1] 2</span></a>
<a class="sourceLine" id="cb28-14" data-line-number="14"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb28-15" data-line-number="15"><span class="co">#&gt; $Z$a_diag_RinvD</span></a>
<a class="sourceLine" id="cb28-16" data-line-number="16"><span class="co">#&gt; [1] 0.1</span></a>
<a class="sourceLine" id="cb28-17" data-line-number="17"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb28-18" data-line-number="18"><span class="co">#&gt; $Z$b_diag_RinvD</span></a>
<a class="sourceLine" id="cb28-19" data-line-number="19"><span class="co">#&gt; [1] 0.01</span></a>
<a class="sourceLine" id="cb28-20" data-line-number="20"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb28-21" data-line-number="21"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb28-22" data-line-number="22"><span class="co">#&gt; $norm</span></a>
<a class="sourceLine" id="cb28-23" data-line-number="23"><span class="co">#&gt;  mu_reg_norm tau_reg_norm   a_tau_norm   b_tau_norm </span></a>
<a class="sourceLine" id="cb28-24" data-line-number="24"><span class="co">#&gt;        0e+00        1e-04        1e-02        1e-02 </span></a>
<a class="sourceLine" id="cb28-25" data-line-number="25"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb28-26" data-line-number="26"><span class="co">#&gt; $gamma</span></a>
<a class="sourceLine" id="cb28-27" data-line-number="27"><span class="co">#&gt;  mu_reg_gamma tau_reg_gamma   a_tau_gamma   b_tau_gamma </span></a>
<a class="sourceLine" id="cb28-28" data-line-number="28"><span class="co">#&gt;         0e+00         1e-04         1e-02         1e-02 </span></a>
<a class="sourceLine" id="cb28-29" data-line-number="29"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb28-30" data-line-number="30"><span class="co">#&gt; $beta</span></a>
<a class="sourceLine" id="cb28-31" data-line-number="31"><span class="co">#&gt;  mu_reg_beta tau_reg_beta   a_tau_beta   b_tau_beta </span></a>
<a class="sourceLine" id="cb28-32" data-line-number="32"><span class="co">#&gt;        0e+00        1e-04        1e-02        1e-02 </span></a>
<a class="sourceLine" id="cb28-33" data-line-number="33"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb28-34" data-line-number="34"><span class="co">#&gt; $logit</span></a>
<a class="sourceLine" id="cb28-35" data-line-number="35"><span class="co">#&gt;  mu_reg_logit tau_reg_logit </span></a>
<a class="sourceLine" id="cb28-36" data-line-number="36"><span class="co">#&gt;         0.000         0.001 </span></a>
<a class="sourceLine" id="cb28-37" data-line-number="37"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb28-38" data-line-number="38"><span class="co">#&gt; $multinomial</span></a>
<a class="sourceLine" id="cb28-39" data-line-number="39"><span class="co">#&gt;  mu_reg_multinomial tau_reg_multinomial </span></a>
<a class="sourceLine" id="cb28-40" data-line-number="40"><span class="co">#&gt;               0.000               0.001 </span></a>
<a class="sourceLine" id="cb28-41" data-line-number="41"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb28-42" data-line-number="42"><span class="co">#&gt; $ordinal</span></a>
<a class="sourceLine" id="cb28-43" data-line-number="43"><span class="co">#&gt;    mu_reg_ordinal   tau_reg_ordinal  mu_delta_ordinal tau_delta_ordinal </span></a>
<a class="sourceLine" id="cb28-44" data-line-number="44"><span class="co">#&gt;             0.000             0.001             0.000             0.001</span></a></code></pre></div>
<p>To change the hyperparameters in a <strong>JointAI</strong> model, the list obtained from <code>default_hyperpars()</code> can be edited and passed to the argument <code>hyperpars</code> in <code>lm_imp()</code>, <code>glm_imp()</code>, <code>lme_imp()</code>, <code>glme_imp()</code> or <code>survreg_imp()</code>.</p>
<p><code>mu_reg_*</code> and <code>tau_reg_*</code> refer to the mean and precision in the distribution for regression coefficients. <code>a_tau_*</code> and <code>b_tau_*</code> are the shape and rate parameters of a Gamma distribution that is used has prior for precision parameters. <code>RinvD</code> is the scale matrix in the Wishart prior for the inverse of the random effects design matrix <code>D</code>, and <code>KinvD</code> the number of degrees of freedom in that distribution. <code>a_diag_RinvD</code> and <code>b_diag_RinvD</code> are the scale and rate parameters of the Gamma prior of the diagonal elements of <code>RinvD</code>. In random effects models with only one random effect, instead of the Wishart distribution a Gamma prior is used for the inverse of <code>D</code>.</p>
<div id="scaling" class="section level3">
<h3>Scaling</h3>
<p>When variables are measured on very different scales this can result in slow convergence and bad mixing. Therefore, <strong>JointAI</strong> automatically scales continuous variables are to have mean zero and standard deviation one. Results (parameters and imputed values) are transformed back to the original scale when the results are printed or imputed values exported.</p>
<p>In some settings, however, it is not possible to scale continuous variables. This is the case for incomplete variables that enter the linear predictor of the analysis model in a function and variables that are imputed with models that are defined on a subset of the real line (i.e., with a Gamma or a Beta distribution). Variables that are imputed with a log-normal distribution are scaled, but not centered.</p>
<p>To prevent scaling, the argument <code>scale_vars</code> can be set to <code>FALSE</code>. When a vector of variable names is supplied to <code>scale_vars</code>, only those variables are scaled.</p>
</div>
</div>
<div id="scaling-1" class="section level2">
<h2>Scaling</h2>
<p>When variables are measured on very different scales this can result in slow convergence and bad mixing. Therefore, <strong>JointAI</strong> automatically scales continuous variables to have mean zero and standard deviation one. Results (parameters and imputed values) are transformed back to the original scale when the results are printed or imputed values are exported.</p>
<p>In some settings, however, it is not possible to scale continuous variables. This is the case for incomplete variables that enter a linear predictor in a function and variables that are imputed with models that are defined on a subset of the real line (i.e., with a Gamma or a Beta distribution). Variables that are imputed with a log-normal distribution are scaled, but not centered. To prevent scaling, the argument <code>scale_vars</code> can be set to <code>FALSE</code>. When a vector of variable names is supplied to <code>scale_vars</code>, only those variables are scaled.</p>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>Note: these examples are chosen to demonstrate functionality and may not fit the data.<a href="#fnref1" class="footnote-back">↩</a></p></li>
<li id="fn2"><p>Again, this is just a demonstration of the possibilities in JointAI, but nesting transformations will most often result in coefficients that that do not have meaningful interpretation in practice.<a href="#fnref2" class="footnote-back">↩</a></p></li>
</ol>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
