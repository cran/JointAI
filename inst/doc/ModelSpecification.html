<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />


<meta name="date" content="2020-06-20" />

<title>Model Specification</title>

<script src="ModelSpecification_files/header-attrs-2.21/header-attrs.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<link rel="stylesheet" href="C:/Users/erler/AppData/Local/R/win-library/4.3/rmarkdown/rmarkdown/templates/html_vignette/resources/vignette.css" type="text/css" />




</head>

<body>




<h1 class="title toc-ignore">Model Specification</h1>
<h4 class="date">2020-06-20</h4>


<div id="TOC">
<ul>
<li><a href="#analysis-model-type" id="toc-analysis-model-type">Analysis
model type</a>
<ul>
<li><a href="#model-family-and-link-functions"
id="toc-model-family-and-link-functions">Model family and link
functions</a></li>
</ul></li>
<li><a href="#ModelFormula" id="toc-ModelFormula">Model formula</a>
<ul>
<li><a href="#interactions" id="toc-interactions">Interactions</a></li>
<li><a href="#non-linear-functional-forms"
id="toc-non-linear-functional-forms">Non-linear functional
forms</a></li>
</ul></li>
<li><a href="#MultiLevelStructure"
id="toc-MultiLevelStructure">Multi-level structure &amp; longitudinal
covariates</a>
<ul>
<li><a href="#random-effects" id="toc-random-effects">Random
effects</a></li>
<li><a href="#longitudinal-covariates"
id="toc-longitudinal-covariates">Longitudinal covariates</a></li>
</ul></li>
<li><a href="#meth" id="toc-meth">Covariate model types</a>
<ul>
<li><a href="#specification-of-covariate-model-types"
id="toc-specification-of-covariate-model-types">Specification of
covariate model types</a></li>
<li><a href="#order-of-the-sequence-of-imputation-models"
id="toc-order-of-the-sequence-of-imputation-models">Order of the
sequence of imputation models</a></li>
</ul></li>
<li><a href="#auxvars" id="toc-auxvars">Auxiliary variables</a>
<ul>
<li><a href="#functions-of-variables-as-auxiliary-variables"
id="toc-functions-of-variables-as-auxiliary-variables">Functions of
variables as auxiliary variables</a></li>
</ul></li>
<li><a href="#categorical-covariates-coding-and-reference-categories"
id="toc-categorical-covariates-coding-and-reference-categories">Categorical
covariates: coding and reference categories</a>
<ul>
<li><a href="#coding" id="toc-coding">Coding</a></li>
<li><a href="#reference-categories"
id="toc-reference-categories">Reference categories</a></li>
</ul></li>
<li><a href="#hyper-parameters"
id="toc-hyper-parameters">Hyper-parameters</a></li>
<li><a href="#scaling" id="toc-scaling">Scaling</a></li>
<li><a href="#shrinkage" id="toc-shrinkage">Shrinkage</a></li>
</ul>
</div>

<p>In this vignette, we use the <a
href="https://nerler.github.io/JointAI/reference/NHANES.html">NHANES</a>
data for examples in cross-sectional data and the dataset <a
href="https://nerler.github.io/JointAI/reference/simLong.html">simLong</a>
for examples in longitudinal data. For more info on these datasets,
check out the vignette <a
href="https://nerler.github.io/JointAI/articles/VisualizingIncompleteData.html"><em>Visualizing
Incomplete Data</em></a>, in which the distributions of variables and
missing values in both sets is explored.</p>
<p>To learn more about the theoretical background of the statistical
approach implemented in <strong>JointAI</strong>, check out the vignette
<a
href="https://nerler.github.io/JointAI/articles/TheoreticalBackground.html">Theoretical
Background</a>.</p>
<p><strong>Note:</strong><br> In some of the examples we use
<code>n.adapt = 0</code> (and <code>n.iter = 0</code>, which is the
default). This is to prevent the MCMC sampling and thereby reduce
computational time when compiling this vignette.</p>
<div id="analysis-model-type" class="section level2">
<h2>Analysis model type</h2>
<p><strong>JointAI</strong> has several main functions (which are
abbreviated with <code>*_imp()</code>):</p>
<ul>
<li><code>lm_imp()</code>: linear regression</li>
<li><code>glm_imp()</code>: generalized linear regression</li>
<li><code>lognorm_imp()</code>: log-normal regression</li>
<li><code>betareg_imp()</code>: beta regression</li>
<li><code>clm_imp()</code>: cumulative logit models for ordinal
data</li>
<li><code>mlogit_imp()</code>: multinomial logit models for unordered
factors</li>
<li><code>lme_imp()</code> / <code>lmer_imp()</code>: linear mixed
effects regression</li>
<li><code>glme_imp()</code> / <code>glmer_imp()</code>: generalized
linear mixed effects regression</li>
<li><code>lognormmm_imp()</code>: log-normal mixed effects
regression</li>
<li><code>betamm_imp()</code>: beta mixed effects regression</li>
<li><code>clmm_imp()</code>: cumulative logit mixed models</li>
<li><code>mlogitmm_imp()</code>: multinomial logit mixed models</li>
<li><code>survreg_imp()</code>: parametric (Weibull) survival
models</li>
<li><code>coxph_imp()</code>: Proportional hazards survival models</li>
<li><code>JM_imp()</code>: Joint model for longitudinal and survival
data</li>
</ul>
<p>Specification of these functions is similar to the specification of
the complete data versions <code>lm()</code>, <code>glm()</code>,
<code>lme()</code> (from package <a
href="https://CRAN.R-project.org/package=nlme"><strong>nlme</strong></a>)
or <a
href="https://stat.ethz.ch/R-manual/R-devel/library/nlme/html/lme.html"><code>lmer()</code></a>
(from package <a
href="https://CRAN.R-project.org/package=lme4"><strong>lme4</strong></a>)
and <a
href="https://stat.ethz.ch/R-manual/R-devel/library/survival/html/survreg.html"><code>survreg()</code></a>
and <a
href="https://stat.ethz.ch/R-manual/R-devel/library/survival/html/coxph.html"><code>coxph()</code></a>
(from package <a
href="https://CRAN.R-project.org/package=survival"><strong>survival</strong></a>).</p>
<p>All functions require the arguments <code>formula</code> (or
<code>fixed</code> and <code>random</code> in for mixed models) and
<code>data</code>.</p>
<p>Specification of the (fixed effects) model formula is demonstrated in
section <a href="#ModelFormula">Model formula</a>, specification of the
random random effects in section <a
href="#MultiLevelStructure">Multi-level structure &amp; longitudinal
covariates</a>.</p>
<p>Additionally, <code>glm_imp()</code>, <code>glme_imp()</code> and
<code>glmer_imp()</code> require the specification of the model <a
href="https://stat.ethz.ch/R-manual/R-devel/library/stats/html/family.html"><code>family</code></a>
(and <code>link</code> function).</p>
<div id="model-family-and-link-functions" class="section level3">
<h3>Model family and link functions</h3>
<p>Implemented families and links for <code>glm_imp()</code>,
<code>glme_imp()</code> and <code>glmer_imp()</code> are</p>
<table>
<thead>
<tr class="header">
<th align="left">family</th>
<th align="left"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>gaussian</code></td>
<td align="left">with links: <code>identity</code>,
<code>log</code></td>
</tr>
<tr class="even">
<td align="left"><code>binomial</code></td>
<td align="left">with links: <code>logit</code>, <code>probit</code>,
<code>log</code>, <code>cloglog</code></td>
</tr>
<tr class="odd">
<td align="left"><code>Gamma</code></td>
<td align="left">with links: <code>inverse</code>,
<code>identity</code>, <code>log</code></td>
</tr>
<tr class="even">
<td align="left"><code>poisson</code></td>
<td align="left">with links: <code>log</code>,
<code>identity</code></td>
</tr>
</tbody>
</table>
<p>The argument <code>family</code> can be provided as character string
or as a function. If the link function is omitted, the <a
href="https://stat.ethz.ch/R-manual/R-devel/library/stats/html/family.html">default
link</a> is used.</p>
<p><strong>Example:</strong><br> The following three specifications are
equal:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>mod1a <span class="ot">&lt;-</span> <span class="fu">glm_imp</span>(educ <span class="sc">~</span> age <span class="sc">+</span> gender <span class="sc">+</span> creat, <span class="at">data =</span> NHANES,</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>, <span class="at">n.adapt =</span> <span class="dv">0</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>mod1b <span class="ot">&lt;-</span> <span class="fu">glm_imp</span>(educ <span class="sc">~</span> age <span class="sc">+</span> gender <span class="sc">+</span> creat, <span class="at">data =</span> NHANES,</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">family =</span> <span class="fu">binomial</span>(), <span class="at">n.adapt =</span> <span class="dv">0</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>mod1c <span class="ot">&lt;-</span> <span class="fu">glm_imp</span>(educ <span class="sc">~</span> age <span class="sc">+</span> gender <span class="sc">+</span> creat, <span class="at">data =</span> NHANES,</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>                 <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&#39;logit&#39;</span>), <span class="at">n.adapt =</span> <span class="dv">0</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>mod1a<span class="sc">$</span>analysis_type</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;glm&quot;</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; attr(,&quot;family&quot;)</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Family: binomial </span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Link function: logit</span></span></code></pre></div>
<p>To use, for instance, a “probit” link instead, this needs to be
specified explicitly:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>mod1d <span class="ot">&lt;-</span> <span class="fu">glm_imp</span>(educ <span class="sc">~</span> age <span class="sc">+</span> gender <span class="sc">+</span> creat, <span class="at">data =</span> NHANES,</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&#39;probit&#39;</span>), <span class="at">n.adapt =</span> <span class="dv">0</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>mod1d<span class="sc">$</span>analysis_type</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;glm&quot;</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; attr(,&quot;family&quot;)</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Family: binomial </span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Link function: probit</span></span></code></pre></div>
</div>
</div>
<div id="ModelFormula" class="section level2">
<h2>Model formula</h2>
<p>The arguments <code>formula</code> and <code>fixed</code> take a
two-sided <a
href="https://stat.ethz.ch/R-manual/R-devel/library/stats/html/formula.html"><code>formula</code></a>
object, where <code>~</code> separates the response (outcome / dependent
variable) from the linear predictor, in which covariates (independent
variables) are separated by <code>+</code>. An intercept is added
automatically (except in proportional hazard models or models for
ordinal outcomes).</p>
<p><code>survreg_imp()</code> and <code>coxph_imp()</code> expect a <a
href="https://stat.ethz.ch/R-manual/R-devel/library/survival/html/Surv.html">survival
object</a> (created with <code>Surv()</code>) on the left hand side of
the model formula. Currently, only right censored data can be handled
and there can only be one type of event (i.e., no competing risks or
multi-state models).</p>
<p>Note: <code>formula</code> and <code>fixed</code> can not be
specified together. You either need to provide the argument
<code>formula</code> or the arguments <code>fixed</code> and
<code>random</code>.</p>
<div id="interactions" class="section level3">
<h3>Interactions</h3>
<p>Interactions between variables can be introduced using <code>:</code>
or <code>*</code>, which adds the interaction term AND the main effects,
i.e.,</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>SBP <span class="sc">~</span> age <span class="sc">+</span> gender <span class="sc">+</span> smoke <span class="sc">*</span> creat</span></code></pre></div>
<p>is equivalent to</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>SBP <span class="sc">~</span> age <span class="sc">+</span> gender <span class="sc">+</span> smoke <span class="sc">+</span> creat <span class="sc">+</span> smoke<span class="sc">:</span>creat</span></code></pre></div>
<div id="interaction-with-multiple-variables" class="section level4">
<h4>Interaction with multiple variables</h4>
<p>Interactions between multiple variables can be specified using
parentheses:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>mod2a <span class="ot">&lt;-</span> <span class="fu">glm_imp</span>(educ <span class="sc">~</span> gender <span class="sc">*</span> (age <span class="sc">+</span> smoke <span class="sc">+</span> creat),</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> NHANES, <span class="at">family =</span> <span class="fu">binomial</span>(), <span class="at">n.adapt =</span> <span class="dv">0</span>)</span></code></pre></div>
<p>The function <a
href="https://nerler.github.io/JointAI/reference/parameters.html"><code>parameters()</code></a>
returns a matrix off all parameters that are specified to be followed
(column <code>coef</code>) and, for regression coefficients, the name of
the variable the coefficient relates to (<code>varname</code>), the
outcome variable of the respective model <code>outcome</code>. For
multinomial models, which have multiple linear predictors, the column
<code>outcat</code> identifies the category of the outcome the
parameters refer to.</p>
<p>We use the function <code>parameters()</code> here and in other
vignettes to demonstrate the effect that different model specifications
have.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">parameters</span>(mod2a)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Note: &quot;mod2a&quot; does not contain MCMC samples.</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    outcome outcat                   varname     coef</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1     educ   &lt;NA&gt;               (Intercept)  beta[1]</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2     educ   &lt;NA&gt;              genderfemale  beta[2]</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3     educ   &lt;NA&gt;                       age  beta[3]</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4     educ   &lt;NA&gt;               smokeformer  beta[4]</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5     educ   &lt;NA&gt;              smokecurrent  beta[5]</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6     educ   &lt;NA&gt;                     creat  beta[6]</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 7     educ   &lt;NA&gt;          genderfemale:age  beta[7]</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 8     educ   &lt;NA&gt;  genderfemale:smokeformer  beta[8]</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 9     educ   &lt;NA&gt; genderfemale:smokecurrent  beta[9]</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10    educ   &lt;NA&gt;        genderfemale:creat beta[10]</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 11   creat   &lt;NA&gt;               (Intercept) alpha[1]</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 12   creat   &lt;NA&gt;              genderfemale alpha[2]</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 13   creat   &lt;NA&gt;                       age alpha[3]</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 14   creat   &lt;NA&gt;               smokeformer alpha[4]</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 15   creat   &lt;NA&gt;              smokecurrent alpha[5]</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 16   smoke   &lt;NA&gt;              genderfemale alpha[6]</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 17   smoke   &lt;NA&gt;                       age alpha[7]</span></span></code></pre></div>
</div>
<div id="higher-level-interactions" class="section level4">
<h4>Higher level interactions</h4>
<p>To specify interactions of a given level, <code>^</code> can be
used:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># all two-way interactions:</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>mod2b <span class="ot">&lt;-</span> <span class="fu">glm_imp</span>(educ <span class="sc">~</span> gender <span class="sc">+</span> (age <span class="sc">+</span> smoke <span class="sc">+</span> creat)<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> NHANES, <span class="at">family =</span> <span class="fu">binomial</span>(), <span class="at">n.adapt =</span> <span class="dv">0</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="fu">parameters</span>(mod2b)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    outcome outcat            varname     coef</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1     educ   &lt;NA&gt;        (Intercept)  beta[1]</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2     educ   &lt;NA&gt;       genderfemale  beta[2]</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3     educ   &lt;NA&gt;                age  beta[3]</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4     educ   &lt;NA&gt;        smokeformer  beta[4]</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5     educ   &lt;NA&gt;       smokecurrent  beta[5]</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6     educ   &lt;NA&gt;              creat  beta[6]</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 7     educ   &lt;NA&gt;    age:smokeformer  beta[7]</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 8     educ   &lt;NA&gt;   age:smokecurrent  beta[8]</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 9     educ   &lt;NA&gt;          age:creat  beta[9]</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10    educ   &lt;NA&gt;  smokeformer:creat beta[10]</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 11    educ   &lt;NA&gt; smokecurrent:creat beta[11]</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 12   creat   &lt;NA&gt;        (Intercept) alpha[1]</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 13   creat   &lt;NA&gt;       genderfemale alpha[2]</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 14   creat   &lt;NA&gt;                age alpha[3]</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 15   creat   &lt;NA&gt;        smokeformer alpha[4]</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 16   creat   &lt;NA&gt;       smokecurrent alpha[5]</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 17   smoke   &lt;NA&gt;       genderfemale alpha[6]</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 18   smoke   &lt;NA&gt;                age alpha[7]</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a><span class="co"># all two- and three-way interactions:</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>mod2c <span class="ot">&lt;-</span> <span class="fu">glm_imp</span>(educ <span class="sc">~</span> gender <span class="sc">+</span> (age <span class="sc">+</span> smoke <span class="sc">+</span> creat)<span class="sc">^</span><span class="dv">3</span>,</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> NHANES, <span class="at">family =</span> <span class="fu">binomial</span>(), <span class="at">n.adapt =</span> <span class="dv">0</span>)</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a><span class="fu">parameters</span>(mod2c)</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    outcome outcat                varname     coef</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1     educ   &lt;NA&gt;            (Intercept)  beta[1]</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2     educ   &lt;NA&gt;           genderfemale  beta[2]</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3     educ   &lt;NA&gt;                    age  beta[3]</span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4     educ   &lt;NA&gt;            smokeformer  beta[4]</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5     educ   &lt;NA&gt;           smokecurrent  beta[5]</span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6     educ   &lt;NA&gt;                  creat  beta[6]</span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 7     educ   &lt;NA&gt;        age:smokeformer  beta[7]</span></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 8     educ   &lt;NA&gt;       age:smokecurrent  beta[8]</span></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 9     educ   &lt;NA&gt;              age:creat  beta[9]</span></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10    educ   &lt;NA&gt;      smokeformer:creat beta[10]</span></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 11    educ   &lt;NA&gt;     smokecurrent:creat beta[11]</span></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 12    educ   &lt;NA&gt;  age:smokeformer:creat beta[12]</span></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 13    educ   &lt;NA&gt; age:smokecurrent:creat beta[13]</span></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 14   creat   &lt;NA&gt;            (Intercept) alpha[1]</span></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 15   creat   &lt;NA&gt;           genderfemale alpha[2]</span></span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 16   creat   &lt;NA&gt;                    age alpha[3]</span></span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 17   creat   &lt;NA&gt;            smokeformer alpha[4]</span></span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 18   creat   &lt;NA&gt;           smokecurrent alpha[5]</span></span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 19   smoke   &lt;NA&gt;           genderfemale alpha[6]</span></span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 20   smoke   &lt;NA&gt;                    age alpha[7]</span></span></code></pre></div>
<p>In <strong>JointAI</strong>, interactions between any variables,
observed or incomplete, variables on different levels of a hierarchical
structure, can be handled. When an incomplete variable is involved, the
interaction term is re-calculated within each iteration of the MCMC
sampling, using the imputed values from the current iteration.</p>
<p>It is <strong>important</strong> not to pre-calculate interactions
with incomplete variables as extra variables in the dataset, but to
specify them in the model formula. Otherwise, imputed values of the main
effect and interaction term will not match, and results may be
incorrect.</p>
</div>
</div>
<div id="non-linear-functional-forms" class="section level3">
<h3>Non-linear functional forms</h3>
<p>In practice, associations between outcome and covariates do not
always meet the standard assumption that all covariate effects are
linear. Often, assuming a logarithmic, quadratic, or other non-linear
effect is more appropriate.</p>
<p>Non-linear associations can be specified in the model formula using
functions such as <a
href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/Log.html"><code>log()</code></a>
(the natural logarithm), <a
href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/MathFun.html"><code>sqrt()</code></a>
(the square root) or <a
href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/Log.html"><code>exp()</code></a>
(the exponential function). It is also possible to use algebraic
operations to calculate a new variable from one or more covariates. To
indicate to R that the operators used in the formula should be
interpreted as algebraic operators and not as formula operators, such
calculations need to be wrapped in the function <a
href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/AsIs.html"><code>I()</code></a>.</p>
<p>For example, to include a quadratic effect of the variable
<code>x</code> we would have to use <code>I(x^2)</code>. Just writing
<code>x^2</code> would be interpreted as the interaction of
<code>x</code> with itself, which simplifies to just <code>x</code>.</p>
<p>For <em>completely observed covariates</em>, <strong>JointAI</strong>
can handle any standard type of function implemented in R. This also
includes splines, e.g., using <a
href="https://stat.ethz.ch/R-manual/R-devel/library/splines/html/ns.html"><code>ns()</code></a>
or <a
href="https://stat.ethz.ch/R-manual/R-devel/library/splines/html/bs.html"><code>bs()</code></a>
from the package <strong>splines</strong> (which is automatically
installed with R).</p>
<p>Functions involving <em>variables that have missing values</em> need
to be re-calculated in each iteration of the MCMC sampling. Therefore,
currently, only functions that can be interpreted by <a
href="https://mcmc-jags.sourceforge.io/">JAGS</a> can be used for
incomplete variables. Those functions include:</p>
<ul>
<li><code>log()</code>, <code>exp()</code></li>
<li><code>sqrt()</code>,</li>
<li><code>abs()</code></li>
<li><code>sin()</code>, <code>cos()</code></li>
<li>polynomials (using <code>I()</code>) and other algebraic operations
involving one or multiple (in)complete variables, as long as the formula
can be interpreted by <a
href="https://mcmc-jags.sourceforge.io/">JAGS</a>.</li>
</ul>
<p>The list of functions implemented in JAGS can be found in the <a
href="https://sourceforge.net/projects/mcmc-jags/files/Manuals/">JAGS
user manual</a>.</p>
<p><strong>Some examples:</strong><a href="#fn1" class="footnote-ref"
id="fnref1"><sup>1</sup></a></p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Absolute difference between bili and creat</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>mod3a <span class="ot">&lt;-</span> <span class="fu">lm_imp</span>(SBP <span class="sc">~</span> age <span class="sc">+</span> gender <span class="sc">+</span> <span class="fu">abs</span>(bili <span class="sc">-</span> creat), <span class="at">data =</span> NHANES)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Using a natural cubic spline for age (completely observed) and a quadratic</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># and a cubic effect for bili</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(splines)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>mod3b <span class="ot">&lt;-</span> <span class="fu">lm_imp</span>(SBP <span class="sc">~</span> <span class="fu">ns</span>(age, <span class="at">df =</span> <span class="dv">2</span>) <span class="sc">+</span> gender <span class="sc">+</span> <span class="fu">I</span>(bili<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">I</span>(bili<span class="sc">^</span><span class="dv">3</span>), <span class="at">data =</span> NHANES)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co"># A function of creat and albu</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>mod3c <span class="ot">&lt;-</span> <span class="fu">lm_imp</span>(SBP <span class="sc">~</span> age <span class="sc">+</span> gender <span class="sc">+</span> <span class="fu">I</span>(creat<span class="sc">/</span>albu<span class="sc">^</span><span class="dv">2</span>), <span class="at">data =</span> NHANES,</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>                <span class="at">models =</span> <span class="fu">c</span>(<span class="at">creat =</span> <span class="st">&#39;lognorm&#39;</span>, <span class="at">albu =</span> <span class="st">&#39;lognorm&#39;</span>))</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="co"># This function may make more sense to calculate BMI as weight/height^2, but</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="co"># we currently do not have those variables in the NHANES dataset.</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Using the sine and cosine</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>mod3d <span class="ot">&lt;-</span> <span class="fu">lm_imp</span>(SBP <span class="sc">~</span> bili <span class="sc">+</span> <span class="fu">sin</span>(creat) <span class="sc">+</span> <span class="fu">cos</span>(albu), <span class="at">data =</span> NHANES)</span></code></pre></div>
<div id="what-happens-inside-jointai" class="section level4">
<h4>What happens inside <strong>JointAI</strong>?</h4>
<p>When a model formula includes a function of a complete or incomplete
variable, the main effect of that variable is automatically added as an
auxiliary variable. (For more info on auxiliary variables, see the
section <a href="#auxvars">“Auxiliary variables”</a>.) In the linear
predictors of models for covariates, usually, only the main effects are
used.</p>
<p>In <code>mod3b</code> from above, for example, the spline of age is
used as predictor for <code>SBP</code>, but in the imputation model for
<code>bili</code>, <code>age</code> enters with a linear effect.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">list_models</span>(mod3b, <span class="at">priors =</span> <span class="cn">FALSE</span>, <span class="at">regcoef =</span> <span class="cn">FALSE</span>, <span class="at">otherpars =</span> <span class="cn">FALSE</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Linear model for &quot;SBP&quot; </span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    family: gaussian </span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    link: identity </span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; * Predictor variables:</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   (Intercept), ns(age, df = 2)1, ns(age, df = 2)2, genderfemale, I(bili^2), I(bili^3) </span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Linear model for &quot;bili&quot; </span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    family: gaussian </span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    link: identity </span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; * Predictor variables:</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   (Intercept), age, genderfemale</span></span></code></pre></div>
<p>The function <a
href="https://nerler.github.io/JointAI/reference/list_models.html"><code>list_models()</code></a>
prints information on all sub-models specified in a <code>JointAI</code>
object. This includes the model(s) specified by the user via the model
formula and all models for covariates that <strong>JointAI</strong> has
specified automatically. Since here we are only interested in the
predictor variables, we suppress printing of information on prior
distributions, regression coefficients and other parameters by setting
<code>priors</code>, <code>regcoef</code> and <code>otherpars</code> to
<code>FALSE</code>.</p>
<p><br></p>
<p>When a function of a variable is specified as an auxiliary variable,
this function is used (as well) in the models for covariates. For
example, in <code>mod3e</code>, waist circumference (<code>WC</code>) is
not part of the model for <code>SBP</code>, and the auxiliary variable
<code>I(WC^2)</code> is used in the linear predictor of the imputation
model for <code>bili</code>: <a id="mod3e"></a></p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>mod3e <span class="ot">&lt;-</span> <span class="fu">lm_imp</span>(SBP <span class="sc">~</span> age <span class="sc">+</span> gender <span class="sc">+</span> bili, <span class="at">auxvars =</span> <span class="sc">~</span> <span class="fu">I</span>(WC<span class="sc">^</span><span class="dv">2</span>), <span class="at">data =</span> NHANES)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">list_models</span>(mod3e, <span class="at">priors =</span> <span class="cn">FALSE</span>, <span class="at">regcoef =</span> <span class="cn">FALSE</span>, <span class="at">otherpars =</span> <span class="cn">FALSE</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Linear model for &quot;SBP&quot; </span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    family: gaussian </span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    link: identity </span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; * Predictor variables:</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   (Intercept), age, genderfemale, bili </span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Linear model for &quot;bili&quot; </span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    family: gaussian </span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    link: identity </span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; * Predictor variables:</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   (Intercept), age, genderfemale, I(WC^2) </span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Linear model for &quot;WC&quot; </span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    family: gaussian </span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    link: identity </span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; * Predictor variables:</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   (Intercept), age, genderfemale</span></span></code></pre></div>
<p>When <code>WC</code> is used as predictor variable in the main model
and a function of <code>WC</code> is specified as auxiliary variable,
both variables are used as predictors in the imputation models:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>mod3f <span class="ot">&lt;-</span> <span class="fu">lm_imp</span>(SBP <span class="sc">~</span> age <span class="sc">+</span> gender <span class="sc">+</span> bili <span class="sc">+</span> WC, <span class="at">auxvars =</span> <span class="sc">~</span> <span class="fu">I</span>(WC<span class="sc">^</span><span class="dv">2</span>), <span class="at">data =</span> NHANES)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">list_models</span>(mod3f, <span class="at">priors =</span> <span class="cn">FALSE</span>, <span class="at">regcoef =</span> <span class="cn">FALSE</span>, <span class="at">otherpars =</span> <span class="cn">FALSE</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Linear model for &quot;SBP&quot; </span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    family: gaussian </span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    link: identity </span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; * Predictor variables:</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   (Intercept), age, genderfemale, bili, WC </span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Linear model for &quot;bili&quot; </span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    family: gaussian </span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    link: identity </span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; * Predictor variables:</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   (Intercept), age, genderfemale, WC, I(WC^2) </span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Linear model for &quot;WC&quot; </span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    family: gaussian </span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    link: identity </span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; * Predictor variables:</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   (Intercept), age, genderfemale</span></span></code></pre></div>
<p>When a function of a covariate is used in the linear predictor of the
analysis model, and that function should also be used in the linear
predictor of imputation models, it is necessary to also include that
function in the argument <code>auxvars</code>:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>mod3g <span class="ot">&lt;-</span> <span class="fu">lm_imp</span>(SBP <span class="sc">~</span> age <span class="sc">+</span> gender <span class="sc">+</span> bili <span class="sc">+</span> <span class="fu">I</span>(WC<span class="sc">^</span><span class="dv">2</span>), <span class="at">auxvars =</span> <span class="sc">~</span> <span class="fu">I</span>(WC<span class="sc">^</span><span class="dv">2</span>), <span class="at">data =</span> NHANES)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">list_models</span>(mod3g, <span class="at">priors =</span> <span class="cn">FALSE</span>, <span class="at">regcoef =</span> <span class="cn">FALSE</span>, <span class="at">otherpars =</span> <span class="cn">FALSE</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Linear model for &quot;SBP&quot; </span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    family: gaussian </span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    link: identity </span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; * Predictor variables:</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   (Intercept), age, genderfemale, bili, I(WC^2) </span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Linear model for &quot;bili&quot; </span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    family: gaussian </span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    link: identity </span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; * Predictor variables:</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   (Intercept), age, genderfemale, WC, I(WC^2) </span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Linear model for &quot;WC&quot; </span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    family: gaussian </span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    link: identity </span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; * Predictor variables:</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   (Intercept), age, genderfemale</span></span></code></pre></div>
<p>Incomplete variables are always imputed on their original scale,
i.e.,</p>
<ul>
<li>in <code>mod3b</code> the variable <code>bili</code> is imputed and
the quadratic and cubic versions calculated from the imputed
values.</li>
<li>Likewise, <code>creat</code> and <code>albu</code> in
<code>mod3c</code> are imputed separately, and
<code>I(creat/albu^2)</code> calculated from the imputed (and observed)
values.</li>
</ul>
<p><strong>Important:</strong> <br> When different transformations of
the same incomplete variable are used in one model, it is strongly
discouraged to calculate these transformations beforehand and to supply
them as separate variables. The same is the case for interactions. <br>
If, for example, a model formula contains both <code>x</code> and
<code>x2</code> (where <code>x2</code> = <code>x^2</code>), they are
treated as separate variables and imputed with different models. Imputed
values of <code>x2</code> are thus not equal to the square of imputed
values of <code>x</code>. Instead, <code>x + I(x^2)</code> should be
used in the model formula. Then, only <code>x</code> is imputed and used
in the linear predictor of models for other incomplete variables, and
<code>x^2</code> is calculated from the imputed values of
<code>x</code>.</p>
</div>
<div id="functions-with-restricted-support" class="section level4">
<h4>Functions with restricted support</h4>
<p>When a function has restricted support, e.g., <code>log(x)</code> is
only defined for <code>x &gt; 0</code>, the model used to impute
<code>x</code> needs to comply with these restrictions. This can either
be achieved by truncating the distribution assumed for <code>x</code>,
using the argument <code>trunc</code>, or by specifying a model for
<code>x</code> that meets the restrictions. For more information on
imputation methods (models for covariates), see the section <a
href="#meth">Imputation model types</a>.</p>
<p><strong>Example</strong>:<br> When using a <code>log()</code>
transformation for the covariate <code>bili</code>, we can either use
the default model for continuous variables, <code>"lm"</code>, a linear
model, i.e., assuming a normal distribution and truncate this
distribution by specifying
<code>trunc = list(bili = c(&lt;lower&gt;, &lt;upper&gt;))</code> (where
the lower and upper limits are the smallest and largest allowed values)
or choose a model (using the argument <code>models</code>; more details
see the section on <a href="#meth">covariate model types</a>) that only
imputes positive values such as a log-normal distribution
(<code>"glm_lognorm"</code>) or a Gamma distribution (e.g.,
<code>"glm_gamma_log"</code>): <a id="mod4"></a></p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># truncation of the distribution of  bili</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>mod4a <span class="ot">&lt;-</span> <span class="fu">lm_imp</span>(SBP <span class="sc">~</span> age <span class="sc">+</span> gender <span class="sc">+</span> <span class="fu">log</span>(bili) <span class="sc">+</span> <span class="fu">exp</span>(creat),</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">trunc =</span> <span class="fu">list</span>(<span class="at">bili =</span> <span class="fu">c</span>(<span class="fl">1e-5</span>, <span class="cn">NA</span>)), <span class="at">data =</span> NHANES)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># log-normal model for bili</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>mod4b <span class="ot">&lt;-</span> <span class="fu">lm_imp</span>(SBP <span class="sc">~</span> age <span class="sc">+</span> gender <span class="sc">+</span> <span class="fu">log</span>(bili) <span class="sc">+</span> <span class="fu">exp</span>(creat),</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">models =</span> <span class="fu">c</span>(<span class="at">bili =</span> <span class="st">&#39;lognorm&#39;</span>, <span class="at">creat =</span> <span class="st">&#39;lm&#39;</span>), <span class="at">data =</span> NHANES)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co"># gamma model with log-link for bili</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>mod4c <span class="ot">&lt;-</span> <span class="fu">lm_imp</span>(SBP <span class="sc">~</span> age <span class="sc">+</span> gender <span class="sc">+</span> <span class="fu">log</span>(bili) <span class="sc">+</span> <span class="fu">exp</span>(creat),</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>                <span class="at">models =</span> <span class="fu">c</span>(<span class="at">bili =</span> <span class="st">&#39;glm_gamma_log&#39;</span>, <span class="at">creat =</span> <span class="st">&#39;lm&#39;</span>), <span class="at">data =</span> NHANES)</span></code></pre></div>
<p>If only one-sided truncation is needed, the other limit can be
provided as <code>NA</code>.</p>
</div>
<div id="functions-that-are-not-available-in-r" class="section level4">
<h4>Functions that are not available in R</h4>
<p>It is possible to use functions that have different names in R and
JAGS, or that do exist in JAGS, but not in R, by defining a new function
in R that has the name of the function in JAGS.</p>
<p><strong>Example</strong>:<br> In JAGS the inverse logit
transformation is defined in the function <code>ilogit</code>. In R,
there is no function <code>ilogit</code>, but the inverse logit is
available as the distribution function of the logistic distribution
<code>plogis()</code>.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the function ilogit</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>ilogit <span class="ot">&lt;-</span> plogis</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use ilogit in the model formula</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>mod5a <span class="ot">&lt;-</span> <span class="fu">lm_imp</span>(SBP <span class="sc">~</span> age <span class="sc">+</span> gender <span class="sc">+</span> <span class="fu">ilogit</span>(creat), <span class="at">data =</span> NHANES)</span></code></pre></div>
</div>
<div id="nested-functions" class="section level4">
<h4>Nested functions</h4>
<p>It is also possible to nest a function in another function.</p>
<p><strong>Example:</strong><a href="#fn2" class="footnote-ref"
id="fnref2"><sup>2</sup></a></p>
<p>The complementary log log transformation is restricted to values
larger than 0 and smaller than 1. In order to use this function on a
variable that exceeds this range, as is the case for <code>creat</code>,
a second transformation might be used, for instance the inverse logit
from the previous example.</p>
<p>In JAGS, the complementary log-log transformation is implemented as
<code>cloglog</code>, but since this function does not exist in (base)
R, we first need to define it:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define the complementary log log transformation</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>cloglog <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">log</span>(<span class="sc">-</span><span class="fu">log</span>(<span class="dv">1</span> <span class="sc">-</span> x))</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># define the inverse logit (in case you have not done it in the previous example)</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>ilogit <span class="ot">&lt;-</span> plogis</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co"># nest ilogit inside cloglog</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>mod6a <span class="ot">&lt;-</span> <span class="fu">lm_imp</span>(SBP <span class="sc">~</span> age <span class="sc">+</span> gender <span class="sc">+</span> <span class="fu">cloglog</span>(<span class="fu">ilogit</span>(creat)), <span class="at">data =</span> NHANES)</span></code></pre></div>
</div>
</div>
</div>
<div id="MultiLevelStructure" class="section level2">
<h2>Multi-level structure &amp; longitudinal covariates</h2>
<p>In multi-level models, additional to the fixed effects structure
specified by the argument <code>fixed</code> a random effects structure
needs to be provided via the argument <code>random</code>.
Alternatively, it is possible to provide a <code>formula</code> that
contains both the fixed and random effects structure (corresponding to
the specification used in <a
href="https://CRAN.R-project.org/package=lme4"><strong>lme4</strong></a>).</p>
<div id="random-effects" class="section level3">
<h3>Random effects</h3>
<p><code>random</code> takes a one-sided formula starting with a
<code>~</code>. Variables for which a random effect should be included
are usually separated by a <code>+</code>, and the grouping variable is
separated by <code>|</code>. A random intercept is added automatically
and only needs to be specified in a random intercept only model.</p>
<p>A few examples:</p>
<ul>
<li><code>random = ~ 1 | id</code>: random intercept only, with
<code>id</code> as grouping variable</li>
<li><code>random = ~ time | id</code>: random intercept and slope for
variable <code>time</code></li>
<li><code>random = ~ time + I(time^2) | id</code>: random intercept,
slope and quadratic random effect for <code>time</code></li>
<li><code>random = ~ time + x | id</code> random intercept, random slope
for <code>time</code> and random effect for variable <code>x</code></li>
</ul>
<p>The corresponding specifications using the argument
<code>formula</code> would be</p>
<ul>
<li><code>&lt;fixed effects&gt; + (1 | id)</code></li>
<li><code>&lt;fixed effects&gt; + (time | id)</code></li>
<li><code>&lt;fixed effects&gt; + (time + I(time^2) | id)</code></li>
<li><code>&lt;fixed effects&gt; + (time + x | id)</code></li>
</ul>
<p>It is possible to use splines in the random effects structure (but
only for completely observed variables), e.g.:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>mod7a <span class="ot">&lt;-</span> <span class="fu">lme_imp</span>(bmi <span class="sc">~</span> GESTBIR <span class="sc">+</span> ETHN <span class="sc">+</span> HEIGHT_M <span class="sc">+</span> <span class="fu">ns</span>(age, <span class="at">df =</span> <span class="dv">2</span>),</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">random =</span> <span class="sc">~</span><span class="fu">ns</span>(age, <span class="at">df =</span> <span class="dv">2</span>) <span class="sc">|</span> ID, <span class="at">data =</span> simLong)</span></code></pre></div>
<p>Since <strong>JointAI</strong> version 1.0.0 it is possible to model
multi-level data with multiple levels of grouping In that setting, the
<code>formula</code> specification needs to be used:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&lt;</span>fixed effects<span class="sc">&gt;</span> <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> id) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> center)</span></code></pre></div>
<p>It is possible to model both crossed and nested random effects,
however the distinction between crossed and nested random effects must
come from the coding of the id variables. For example, if patients are
nested in hospitals, all observations that have the same patient id also
need to have the same hospital id.</p>
<p>When this is not the case, i.e., some patients were measured at
multiple hospitals, the random effects are crossed.</p>
<p>There is (theoretically) no restriction as to how many grouping
levels are possible.</p>
</div>
<div id="longitudinal-covariates" class="section level3">
<h3>Longitudinal covariates</h3>
<p>From <strong>JointAI</strong> version 0.5.0 onward imputation of
longitudinal covariates is possible. For details the types of models
that are available for covariates in a multi-level setting, see the
section <a href="#meth">covariate model types</a> below.</p>
<p><strong>Note:</strong><br> When incomplete baseline covariates (level
&gt; 1) are involved in the model it is usually necessary to specify
models for all variables on lower levels, even if they are completely
observed. This is done automatically by <strong>JointAI</strong>, but it
may be necessary to change the default model types to models that better
fit the distributions of the respective variables.</p>
<p>It is typically not necessary to specify models for variables on
higher levels if there are no incomplete covariates on lower levels. For
example, in a 2-level setting, if there are no missing values in level-2
variables, it is not necessary to specify models for completely observed
level-1 variables. But if there are missing values in level-2 variables,
models need to be specified for all level-1 variables.</p>
<div id="why-do-we-need-models-for-completely-observed-covariates"
class="section level4">
<h4>Why do we need models for completely observed covariates?</h4>
<p>The joint distribution of an outcome <span
class="math inline">\(y\)</span>, covariates <span
class="math inline">\(x\)</span>, random effects <span
class="math inline">\(b\)</span> and parameters <span
class="math inline">\(\theta\)</span>, <span class="math inline">\(p(y,
x, b, \theta)\)</span>, is modelled as the product of univariate
conditional distributions. To facilitate the specification of these
distributions they are ordered so that longitudinal (level-1) variables
may have baseline (level-2) variables in their linear predictors but not
vice versa.</p>
<p>For example: <span class="math display">\[\begin{align}
p(y, x, b, \theta) = &amp; p(y \mid x_1, ..., x_4, b_y, \theta_y)
&amp;&amp; \text{analysis model}\\
&amp; p(x_1\mid \theta_{x1}) &amp;&amp; \text{model for a complete
baseline covariate}\\
&amp; p(x_2\mid x_1, \theta_{x2}) &amp;&amp; \text{model for an
incomplete baseline covariate}\\
&amp; p(x_3\mid x_1, x_2, b_{x3}, \theta_{x3}) &amp;&amp; \text{model
for a complete longitudinal covariate}\\
&amp; p(x_4\mid x_1, x_2, x_3, b_{x4}, \theta_{x4}) &amp;&amp;
\text{model for an incomplete longitudinal covariate}\\
&amp; p(b_y|\theta_b) p(b_{x3}|\theta_b) p(b_{x4}|\theta_b) &amp;&amp;
\text{models for the random effects}\\
&amp; p(\theta_y) p(\theta_{x1}) \ldots p(\theta_{x4}) p(\theta_b)
&amp;&amp; \text{prior distributions}\end{align}\]</span></p>
<p>Since the parameter vectors <span
class="math inline">\(\theta_{x1}\)</span>, <span
class="math inline">\(\theta_{x2}\)</span>, … are assumed to be a priori
independent, and furthermore <span class="math inline">\(x_1\)</span> is
completely observed and modelled independently of incomplete variables,
estimation of the other model parts is not affected by <span
class="math inline">\(p(x_1\mid \theta_{x1})\)</span> and, hence, this
model can be omitted.</p>
<p><span class="math inline">\(p(x_3 \mid x_1, x_2, b_{x3},
\theta_{x3})\)</span>, on the other hand is modelled conditional on the
incomplete covariate <span class="math inline">\(x_2\)</span> and can
therefore not be omitted.</p>
<p>If there were no incomplete baseline covariates, i.e., if <span
class="math inline">\(x_2\)</span> was completely observed, <span
class="math inline">\(p(x_3 \mid x_1, x_2, b_{x3}, \theta_{x3})\)</span>
would also not affect the estimation of parameters in the other parts of
the model and could be omitted.</p>
</div>
</div>
</div>
<div id="meth" class="section level2">
<h2>Covariate model types</h2>
<p><strong>JointAI</strong> automatically selects models for all
incomplete covariates (and if necessary also for some complete
covariates). The type of model is selected automatically based on the
<code>class</code> of the variable and the number of levels.</p>
<p>The automatically selected types for baseline (highest level)
covariates are:</p>
<table>
<thead>
<tr class="header">
<th align="left">name</th>
<th align="left">model</th>
<th align="left">variable type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>lm</code></td>
<td align="left">linear regression</td>
<td align="left">continuous variables</td>
</tr>
<tr class="even">
<td align="left"><code>logit</code></td>
<td align="left">logistic regression</td>
<td align="left">factors with two levels</td>
</tr>
<tr class="odd">
<td align="left"><code>mlogit</code></td>
<td align="left">multinomial logit model</td>
<td align="left">unordered factors with &gt;2 levels</td>
</tr>
<tr class="even">
<td align="left"><code>clm</code></td>
<td align="left">cumulative logit model</td>
<td align="left">ordered factors with &gt;2 levels</td>
</tr>
</tbody>
</table>
<p>The default methods for lower level covariates are:</p>
<table>
<colgroup>
<col width="14%" />
<col width="33%" />
<col width="51%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">name</th>
<th align="left">model</th>
<th align="left">variable type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>lmm</code></td>
<td align="left">linear mixed model</td>
<td align="left">continuous longitudinal variables</td>
</tr>
<tr class="even">
<td align="left"><code>glmm_logit</code></td>
<td align="left">logistic mixed model</td>
<td align="left">longitudinal factors with two levels</td>
</tr>
<tr class="odd">
<td align="left"><code>mlogitmm</code></td>
<td align="left">multinomial logit mixed model</td>
<td align="left">longitudinal unordered factors with &gt;2 levels</td>
</tr>
<tr class="even">
<td align="left"><code>clmm</code></td>
<td align="left">cumulative logit mixed model</td>
<td align="left">longitudinal ordered factors with &gt;2 levels</td>
</tr>
</tbody>
</table>
<p>The imputation models that are chosen by default may not necessarily
be appropriate for the data at hand, especially for continuous
variables, which often do not comply with the assumptions of
(conditional) normality.</p>
<p>Therefore, alternative imputation methods are available for baseline
covariates:</p>
<table>
<colgroup>
<col width="16%" />
<col width="50%" />
<col width="32%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">name</th>
<th align="left">model</th>
<th align="left">variable type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>lognorm</code></td>
<td align="left">normal regression of the log-transformed variable</td>
<td align="left">right-skewed variables &gt;0</td>
</tr>
<tr class="even">
<td align="left"><code>beta</code></td>
<td align="left">beta regression (with logit-link)</td>
<td align="left">continuous variables with values in [0, 1]</td>
</tr>
<tr class="odd">
<td align="left"><code>glm_&lt;family&gt;_&lt;link&gt;</code></td>
<td align="left">e.g. <code>glm_gamma_inverse</code> for Gamma
regression with an inverse-link</td>
<td align="left"></td>
</tr>
</tbody>
</table>
<p><code>lognorm</code> assumes a normal distribution for the natural
logarithm of the variable, but the variable enters the linear predictor
of the analysis model (and possibly other imputation models) on its
original scale.</p>
<p>For longitudinal (lower-level) covariates corresponding model types
are . available:</p>
<table>
<colgroup>
<col width="17%" />
<col width="49%" />
<col width="33%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">name</th>
<th align="left">model</th>
<th align="left">variable type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>glmm_lognorm</code></td>
<td align="left">normal mixed model for the log-transformed
variable</td>
<td align="left">longitudinal right-skewed variables &gt;0</td>
</tr>
<tr class="even">
<td align="left"><code>glmm_beta</code></td>
<td align="left">beta regression (with logit-link)</td>
<td align="left">continuous variables with values in [0, 1]</td>
</tr>
<tr class="odd">
<td align="left"><code>glmm_&lt;family&gt;_&lt;link&gt;</code></td>
<td align="left">e.g. <code>glmm_poisson_log</code> for a poisson mixed
model with log-link</td>
<td align="left">longitudinal count variables</td>
</tr>
</tbody>
</table>
<p>Logistic (mixed) models can be abbreviated <code>glm_logit</code>
(<code>glmm_logit</code>).</p>
<div id="specification-of-covariate-model-types" class="section level3">
<h3>Specification of covariate model types</h3>
<p>In models <a href="#mod4"><code>mod4b</code> and
<code>mod4c</code></a> we have already seen two examples in which the
imputation model type was changed using the argument
<code>models</code>.</p>
<p><code>models</code> takes a named vector of (imputation/covariate)
model types, where the names are the names of the covariates. When the
vector supplied to <code>models</code> only contains specifications for
a subset of the covariates, default models are used for the remaining
variables.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>mod8a <span class="ot">&lt;-</span> <span class="fu">lm_imp</span>(SBP <span class="sc">~</span> age <span class="sc">+</span> gender <span class="sc">+</span> WC <span class="sc">+</span> alc <span class="sc">+</span> bili <span class="sc">+</span> occup <span class="sc">+</span> smoke,</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">models =</span> <span class="fu">c</span>(<span class="at">bili =</span> <span class="st">&#39;glm_gamma_log&#39;</span>, <span class="at">WC =</span> <span class="st">&#39;lognorm&#39;</span>),</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> NHANES, <span class="at">n.adapt =</span> <span class="dv">0</span>, <span class="at">progress.bar =</span> <span class="st">&#39;none&#39;</span>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>mod8a<span class="sc">$</span>models</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                     SBP                     alc                   occup                    bili </span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &quot;glm_gaussian_identity&quot;    &quot;glm_binomial_logit&quot;                &quot;mlogit&quot;         &quot;glm_gamma_log&quot; </span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                   smoke                      WC </span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                   &quot;clm&quot;               &quot;lognorm&quot;</span></span></code></pre></div>
<p>When there is a “time” variable in the model, such as
<code>age</code> (age of the child at the time of the measurement) in
the <code>simLong</code> it may not be meaningful to specify a model for
that variable. Especially when the “time” variable is pre-specified by
the design of the study it can usually be assumed to be independent of
the covariates and a model for it has no useful interpretation.</p>
<p>The argument <code>no_model</code> allows us to exclude models for
such variables (as long as they are completely observed):</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>mod8b <span class="ot">&lt;-</span> <span class="fu">lme_imp</span>(bmi <span class="sc">~</span> GESTBIR <span class="sc">+</span> ETHN <span class="sc">+</span> HEIGHT_M <span class="sc">+</span> SMOKE <span class="sc">+</span> hc <span class="sc">+</span> MARITAL <span class="sc">+</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">ns</span>(age, <span class="at">df =</span> <span class="dv">2</span>),</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">random =</span> <span class="sc">~</span><span class="fu">ns</span>(age, <span class="at">df =</span> <span class="dv">2</span>) <span class="sc">|</span> ID, <span class="at">data =</span> simLong,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">no_model =</span> <span class="st">&quot;age&quot;</span>, <span class="at">n.adapt =</span> <span class="dv">0</span>)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>mod8b<span class="sc">$</span>models</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                      bmi                       hc                    SMOKE                  MARITAL </span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &quot;glmm_gaussian_identity&quot;                    &quot;lmm&quot;                    &quot;clm&quot;                 &quot;mlogit&quot; </span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                     ETHN                 HEIGHT_M </span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     &quot;glm_binomial_logit&quot;                     &quot;lm&quot;</span></span></code></pre></div>
<p>By excluding the model for <code>age</code> we implicitly assume that
incomplete baseline variables are independent of <code>age</code>.</p>
<p><strong>Note:</strong><br> When a continuous incomplete variable has
only two different values it is assumed to be binary and its coding and
default imputation model will be changed accordingly. This behaviour can
be overwritten when the imputation method for that variable is specified
directly by the user.</p>
<p>Variables of type <code>logical</code> are automatically converted to
binary factors.</p>
</div>
<div id="order-of-the-sequence-of-imputation-models"
class="section level3">
<h3>Order of the sequence of imputation models</h3>
<p>In <strong>JointAI</strong>, the models automatically specified for
covariates are ordered by the hierarchical level of the respective
response variable (descending). The linear predictor of each model
contains the incomplete variables that are specified later in the
sequence and all complete variables of the same or lower level.</p>
<p>Within each level, models are ordered by the proportion of missing
values in the respective response variables, so that the variable with
the most missing values has the most covariates in its linear
predictor.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_missinfo</span>(mod8a)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $complete_cases</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;          #        %</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; lvlone 116 62.36559</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $miss_list</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $miss_list$lvlone</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;        # NA      % NA</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; SBP       0  0.000000</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; age       0  0.000000</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; gender    0  0.000000</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; WC        2  1.075269</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; smoke     7  3.763441</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; bili      8  4.301075</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; occup    28 15.053763</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; alc      34 18.279570</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a><span class="co"># print information on the imputation models (and omit everything but the predictor variables)</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a><span class="fu">list_models</span>(mod8a, <span class="at">priors =</span> <span class="cn">FALSE</span>, <span class="at">regcoef =</span> <span class="cn">FALSE</span>, <span class="at">otherpars =</span> <span class="cn">FALSE</span>, <span class="at">refcat =</span> <span class="cn">FALSE</span>)</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Linear model for &quot;SBP&quot; </span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    family: gaussian </span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    link: identity </span></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; * Predictor variables:</span></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   (Intercept), age, genderfemale, WC, alc&gt;=1, bili, occuplooking for work, occupnot </span></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   working, smokeformer, smokecurrent </span></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Binomial model for &quot;alc&quot; </span></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    family: binomial </span></span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    link: logit </span></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; * Predictor variables:</span></span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   (Intercept), age, genderfemale, WC, bili, occuplooking for work, occupnot working, </span></span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   smokeformer, smokecurrent </span></span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Multinomial logit model for &quot;occup&quot; </span></span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; * Predictor variables:</span></span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   (Intercept), age, genderfemale, WC, bili, smokeformer, smokecurrent </span></span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Gamma model for &quot;bili&quot; </span></span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    family: Gamma </span></span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    link: log </span></span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; * Parametrization:</span></span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   - shape: shape_bili = mu_bili^2 * tau_bili</span></span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   - rate: rate_bili = mu_bili * tau_bili</span></span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; * Predictor variables:</span></span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   (Intercept), age, genderfemale, WC, smokeformer, smokecurrent </span></span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb20-51"><a href="#cb20-51" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Cumulative logit model for &quot;smoke&quot; </span></span>
<span id="cb20-52"><a href="#cb20-52" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; * Predictor variables:</span></span>
<span id="cb20-53"><a href="#cb20-53" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   age, genderfemale, WC </span></span>
<span id="cb20-54"><a href="#cb20-54" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb20-55"><a href="#cb20-55" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb20-56"><a href="#cb20-56" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Log-normal model for &quot;WC&quot; </span></span>
<span id="cb20-57"><a href="#cb20-57" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    family: lognorm </span></span>
<span id="cb20-58"><a href="#cb20-58" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    link: identity </span></span>
<span id="cb20-59"><a href="#cb20-59" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; * Predictor variables:</span></span>
<span id="cb20-60"><a href="#cb20-60" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   (Intercept), age, genderfemale</span></span></code></pre></div>
</div>
</div>
<div id="auxvars" class="section level2">
<h2>Auxiliary variables</h2>
<p>Auxiliary variables are variables that are not part of the analysis
model, but should be considered as predictor variables in the imputation
models because they can inform the imputation of unobserved values.</p>
<p>Good auxiliary variables are <a href="#fn3" class="footnote-ref"
id="fnref3"><sup>3</sup></a></p>
<ul>
<li>associated with an incomplete variable of interest, or are</li>
<li>associated with the missingness of that variable, and</li>
<li>do not have too many missing values themselves. Importantly, they
should be observed for a large proportion of the cases that have a
missing value in the variable to be imputed.</li>
</ul>
<p>In the main functions, <code>*_imp()</code>, auxiliary variables can
be specified with the argument <code>auxvars</code>, which is a
one-sided formula.</p>
<p><strong>Example:</strong><br> We might consider the variables
<code>educ</code> and <code>smoke</code> as predictors for the
imputation of <code>occup</code>:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>mod9a <span class="ot">&lt;-</span> <span class="fu">lm_imp</span>(SBP <span class="sc">~</span> gender <span class="sc">+</span> age <span class="sc">+</span> occup, <span class="at">auxvars =</span> <span class="sc">~</span> educ <span class="sc">+</span> smoke,</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> NHANES, <span class="at">n.adapt =</span> <span class="dv">0</span>)</span></code></pre></div>
<p>The variables <code>educ</code> and <code>smoke</code> are not used
as predictors in the analysis model. They are, however, used as
predictors in the imputation for <code>occup</code> and imputed
themselves (if they have missing values):</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">list_models</span>(mod9a, <span class="at">priors =</span> <span class="cn">FALSE</span>, <span class="at">regcoef =</span> <span class="cn">FALSE</span>, <span class="at">otherpars =</span> <span class="cn">FALSE</span>, <span class="at">refcat =</span> <span class="cn">FALSE</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Linear model for &quot;SBP&quot; </span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    family: gaussian </span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    link: identity </span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; * Predictor variables:</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   (Intercept), genderfemale, age, occuplooking for work, occupnot working </span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Multinomial logit model for &quot;occup&quot; </span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; * Predictor variables:</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   (Intercept), genderfemale, age, educhigh, smokeformer, smokecurrent </span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Cumulative logit model for &quot;smoke&quot; </span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; * Predictor variables:</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   genderfemale, age, educhigh</span></span></code></pre></div>
<div id="functions-of-variables-as-auxiliary-variables"
class="section level3">
<h3>Functions of variables as auxiliary variables</h3>
<p>As shown above in <a href="#mod3e"><code>mod3e</code></a> and <a
href="#mod3e"><code>mod3f</code></a>, it is possible to specify
functions of auxiliary variables. In that case, the auxiliary variable
is not considered as linear effect but as specified by the function:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>mod9b <span class="ot">&lt;-</span> <span class="fu">lm_imp</span>(SBP <span class="sc">~</span> gender <span class="sc">+</span> age <span class="sc">+</span> occup, <span class="at">data =</span> NHANES,</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">auxvars =</span> <span class="sc">~</span> educ <span class="sc">+</span> smoke <span class="sc">+</span> <span class="fu">log</span>(WC),</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">trunc =</span> <span class="fu">list</span>(<span class="at">WC =</span> <span class="fu">c</span>(<span class="fl">1e-10</span>, <span class="fl">1e10</span>)), <span class="at">n.adapt =</span> <span class="dv">0</span>)</span></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">list_models</span>(mod9b, <span class="at">priors =</span> <span class="cn">FALSE</span>, <span class="at">regcoef =</span> <span class="cn">FALSE</span>, <span class="at">otherpars =</span> <span class="cn">FALSE</span>, <span class="at">refcat =</span> <span class="cn">FALSE</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Linear model for &quot;SBP&quot; </span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    family: gaussian </span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    link: identity </span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; * Predictor variables:</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   (Intercept), genderfemale, age, occuplooking for work, occupnot working </span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Multinomial logit model for &quot;occup&quot; </span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; * Predictor variables:</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   (Intercept), genderfemale, age, educhigh, smokeformer, smokecurrent, log(WC) </span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Cumulative logit model for &quot;smoke&quot; </span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; * Predictor variables:</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   genderfemale, age, educhigh, log(WC) </span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Linear model for &quot;WC&quot; </span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    family: gaussian </span></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    link: identity </span></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; * Predictor variables:</span></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   (Intercept), genderfemale, age, educhigh</span></span></code></pre></div>
<p><strong>Note:</strong><br> Omitting auxiliary variables from the
analysis model implies that the outcome is independent of these
variables, conditional on the other variables in the model. If this is
not true, the model is mis-specified which may lead to biased results
(similar to leaving a confounding variable out of a model).</p>
</div>
</div>
<div id="categorical-covariates-coding-and-reference-categories"
class="section level2">
<h2>Categorical covariates: coding and reference categories</h2>
<div id="coding" class="section level3">
<h3>Coding</h3>
<p>In practice, most often, dummy coding is used for categorical
predictor variables, i.e., a binary variables is created for each
category, except the reference category. These binary variables have
value one when that category was observed and zero otherwise.</p>
<p>This is the default behaviour for unordered factors in R
(<code>contr.treatment()</code>). For ordered factors orthogonal
polynomials (<code>contr.poly()</code>) are used. The type of contrasts
(i.e. “coding”) to be used for unordered and ordered factors can be
checked and set in the global options:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="st">&#39;contrasts&#39;</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $contrasts</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         unordered           ordered </span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &quot;contr.treatment&quot;      &quot;contr.poly&quot;</span></span></code></pre></div>
<p>Since the imputation of incomplete factors is done in the original
variable, the re-coding from the original categorical variable into
dummy variables or other contrasts needs to be done within the JAGS
model. Currently, only dummy coding and reference coding
(<code>contr.sum()</code>) are possible for factors with missing values.
This means that, if the default <code>contr.poly</code> is set for
ordinal factors, a warning message is printed and dummy coding is used
for these variables instead.</p>
</div>
<div id="reference-categories" class="section level3">
<h3>Reference categories</h3>
<p>In <strong>JointAI</strong>, the first category of a categorical
variable is set to be the reference category when using for dummy or
reference coding. However, this may not always allow the desired
interpretation of the regression coefficients. Moreover, when categories
are unbalanced, setting the largest group as reference may result in
better mixing of the MCMC chains.</p>
<p>For unordered factors, it is possible to change the reference
category directly in the data, for example using the base R function
<code>relevel()</code>. For ordinal variables, however, this is not
possible, and especially when the ordinal variable needs imputation it
is desirable to maintain the ordering in the categories.</p>
<p>Therefore, <strong>JointAI</strong> allows specification of the
reference category separately for each variable, via the argument
<code>refcats</code>.</p>
<div id="setting-reference-categories-for-all-variables"
class="section level4">
<h4>Setting reference categories for all variables</h4>
<p>To specify the choice of reference category globally for all
variables in the model, <code>refcats</code> can be set as</p>
<ul>
<li><code>refcats = "first"</code></li>
<li><code>refcats = "last"</code></li>
<li><code>refcats = "largest"</code></li>
</ul>
<p>For example:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>mod10a <span class="ot">&lt;-</span> <span class="fu">lm_imp</span>(SBP <span class="sc">~</span> gender <span class="sc">+</span> age <span class="sc">+</span> race <span class="sc">+</span> educ <span class="sc">+</span> occup <span class="sc">+</span> smoke,</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">refcats =</span> <span class="st">&quot;largest&quot;</span>, <span class="at">data =</span> NHANES, <span class="at">n.adapt =</span> <span class="dv">0</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning: </span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; It is currently not possible to use &quot;contr.poly&quot; for incomplete categorical covariates. I</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; will use &quot;contr.treatment&quot; instead.  You can specify (globally) which types of contrasts</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; are used by changing &quot;options(&#39;contrasts&#39;)&quot;.</span></span></code></pre></div>
</div>
<div id="setting-reference-categories-for-individual-variables"
class="section level4">
<h4>Setting reference categories for individual variables</h4>
<p>Alternatively, <code>refcats</code> takes a named vector, in which
the reference category for each variable can be specified either by its
number or its name, or one of the three global types: “first”, “last” or
“largest”. For variables for which no reference category is specified in
the list the default is used.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>mod10b <span class="ot">&lt;-</span> <span class="fu">lm_imp</span>(SBP <span class="sc">~</span> gender <span class="sc">+</span> age <span class="sc">+</span> race <span class="sc">+</span> educ <span class="sc">+</span> occup <span class="sc">+</span> smoke,</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">refcats =</span> <span class="fu">list</span>(<span class="at">occup =</span> <span class="st">&quot;not working&quot;</span>, <span class="at">race =</span> <span class="dv">3</span>, <span class="at">educ =</span> <span class="st">&#39;largest&#39;</span>),</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> NHANES, <span class="at">n.adapt =</span> <span class="dv">0</span>)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning: </span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; It is currently not possible to use &quot;contr.poly&quot; for incomplete categorical covariates. I</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; will use &quot;contr.treatment&quot; instead.  You can specify (globally) which types of contrasts</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; are used by changing &quot;options(&#39;contrasts&#39;)&quot;.</span></span></code></pre></div>
<p>To help to specify the reference category, the function <a
href="https://nerler.github.io/JointAI/reference/set_refcat.html"><code>set_refcat()</code></a>
can be used. It prints the names of the categorical variables that are
selected by</p>
<ul>
<li>a specified model formula and/or</li>
<li>a vector of auxiliary variables, or</li>
<li>a vector of naming covariates</li>
</ul>
<p>or all categorical variables in the data if only <code>data</code> is
provided, and asks a number of questions which the user needs to reply
to by input of a number.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>refs_mod10 <span class="ot">&lt;-</span> <span class="fu">set_refcat</span>(NHANES, <span class="at">formula =</span> <span class="fu">formula</span>(mod10b))</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; The categorical variables are:</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; - &quot;gender&quot;</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; - &quot;race&quot;</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; - &quot;educ&quot;</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; - &quot;occup&quot;</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; - &quot;smoke&quot;</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; How do you want to specify the reference categories?</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1: Use the first category for each variable.</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2: Use the last category for each variabe.</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3: Use the largest category for each variable.</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4: Specify the reference categories individually.</span></span></code></pre></div>
<p>When option 4 is chosen, a question for each categorical variable is
asked, for example:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; The reference category for “race” should be</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1: Mexican American</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2: Other Hispanic</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3: Non-Hispanic White</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4: Non-Hispanic Black</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5: other</span></span></code></pre></div>
<p>After specification of the reference categories for all categorical
variables, the determined specification for the argument
<code>refcats</code> is printed:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; In the JointAI model specify:</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  refcats = c(gender = &#39;female&#39;, race = &#39;Non-Hispanic White&#39;, educ = &#39;low&#39;,</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;              occup = &#39;not working&#39;, smoke = &#39;never&#39;)</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; or use the output of this function.</span></span></code></pre></div>
<p><code>set_refcat()</code> also returns a named vector that can be
passed to the argument <code>refcats</code>:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>mod10c <span class="ot">&lt;-</span> <span class="fu">lm_imp</span>(SBP <span class="sc">~</span> gender <span class="sc">+</span> age <span class="sc">+</span> race <span class="sc">+</span> educ <span class="sc">+</span> occup <span class="sc">+</span> smoke,</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">refcats =</span> refs_mod10, <span class="at">data =</span> NHANES, <span class="at">n.adapt =</span> <span class="dv">0</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning: </span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; It is currently not possible to use &quot;contr.poly&quot; for incomplete categorical covariates. I</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; will use &quot;contr.treatment&quot; instead.  You can specify (globally) which types of contrasts</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; are used by changing &quot;options(&#39;contrasts&#39;)&quot;.</span></span></code></pre></div>
<p><strong>Note:</strong><br> Changing a reference category via the
argument <code>refcats</code> does not change the order of levels in the
dataset or any of the data matrices inside <strong>JointAI</strong>.
Only when, in the JAGS model, the categorical variables is converted
into dummy variables, the reference category is used to determine for
which levels the dummies are created.</p>
</div>
</div>
</div>
<div id="hyper-parameters" class="section level2">
<h2>Hyper-parameters</h2>
<p>In the Bayesian framework, parameters are random variables for which
a distribution needs to be specified. These distributions depend on
parameters themselves, i.e., on hyper-parameters.</p>
<p>The function <code>default_hyperpars()</code> returns a list
containing the default hyper parameters used in a <code>JointAI</code>
model.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">default_hyperpars</span>()</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $norm</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    mu_reg_norm   tau_reg_norm shape_tau_norm  rate_tau_norm </span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;          0e+00          1e-04          1e-02          1e-02 </span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $gamma</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    mu_reg_gamma   tau_reg_gamma shape_tau_gamma  rate_tau_gamma </span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;           0e+00           1e-04           1e-02           1e-02 </span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $beta</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    mu_reg_beta   tau_reg_beta shape_tau_beta  rate_tau_beta </span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;          0e+00          1e-04          1e-02          1e-02 </span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $binom</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  mu_reg_binom tau_reg_binom </span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         0e+00         1e-04 </span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $poisson</span></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  mu_reg_poisson tau_reg_poisson </span></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;           0e+00           1e-04 </span></span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $multinomial</span></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  mu_reg_multinomial tau_reg_multinomial </span></span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;               0e+00               1e-04 </span></span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ordinal</span></span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    mu_reg_ordinal   tau_reg_ordinal  mu_delta_ordinal tau_delta_ordinal </span></span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             0e+00             1e-04             0e+00             1e-04 </span></span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ranef</span></span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; shape_diag_RinvD  rate_diag_RinvD       KinvD_expr </span></span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;           &quot;0.01&quot;          &quot;0.001&quot;   &quot;nranef + 1.0&quot; </span></span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $surv</span></span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  mu_reg_surv tau_reg_surv </span></span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;        0.000        0.001</span></span></code></pre></div>
<p>To change the hyper-parameters in a <strong>JointAI</strong> model,
the list obtained from <code>default_hyperpars()</code> can be edited
and passed to the argument <code>hyperpars</code> in the main functions
<code>*_imp()</code>.</p>
<ul>
<li><code>mu_reg_*</code> and <code>tau_reg_*</code> refer to the mean
and precision in the distribution for regression coefficients.</li>
<li><code>shape_tau_*</code> and <code>rate_tau_*</code> are the shape
and rate parameters of a Gamma distribution that is used has prior for
precision parameters.</li>
<li><code>KinvD</code> refers to the degrees of freedom in the Wishart
prior used for the inverse of the random effects design matrix
<code>D</code>. <code>KinvD_exp</code> should be a string that can be
evaluated to calculate the number of degrees of freedom depending on the
number of random effects <code>nranef</code> (dimension of
<code>D</code>). By default, <code>KinvD</code> will be set to the
number of random effects plus one.</li>
<li><code>shape_diag_RinvD</code> and <code>rate_diag_RinvD</code> are
the scale and rate parameters of the Gamma prior of the diagonal
elements of <code>RinvD</code>.</li>
</ul>
<p>In random effects models with only one random effect, instead of the
Wishart distribution a Gamma prior is used for the inverse of
<code>D</code>.</p>
</div>
<div id="scaling" class="section level2">
<h2>Scaling</h2>
<p>When variables are measured on very different scales this can result
in slow convergence and bad mixing. Therefore, <strong>JointAI</strong>
includes scaling of continuous covariates in the JAGS model (i.e.,
instead of writing <code>... + covar + ...</code> in the linear
predictor, <code>... + (covar - mean)/sd) + ...</code> is written). The
scaling parameters (mean and standard deviation) are calculated based on
the design matrices containing the original data. Results are
transformed back to the original scale.</p>
<p>By setting the argument <code>scale_vars = FALSE</code> the scaling
can be prevented. If <code>scale_vars</code> is a vector of variable
names, scaling will only be done for those variables.</p>
<p>By default, only the MCMC samples that is scaled back to the scale of
the data is stored in a <code>JointAI</code> object. When the argument
<code>keep_scaled_mcmc = TRUE</code> also the scaled sample is kept.
This is mainly for de-bugging purposes.</p>
</div>
<div id="shrinkage" class="section level2">
<h2>Shrinkage</h2>
<p>It is possible to use shrinkage priors to penalize large regression
coefficients. This can be specified via the argument
<code>shrinkage</code>. At the moment, only ridge regression is
implemented.</p>
<p>Setting <code>shrinkage = 'ridge'</code> will impose ridge priors on
all regression coefficients. To only use shrinkage for some of the
sub-models (main analysis model and covariate models), a vector can be
provided that contains the names of the response variables of the models
in which shrinkage should be applied, and the type of shrinkage for each
of them.</p>
<p>For example, in <code>mod11a</code> ridge regression is used for all
models, and in <code>modd11b</code> only in the models for
<code>SBP</code> and <code>educ</code>:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>mod11a <span class="ot">&lt;-</span> <span class="fu">lm_imp</span>(SBP <span class="sc">~</span> gender <span class="sc">+</span> age <span class="sc">+</span> race <span class="sc">+</span> educ <span class="sc">+</span> occup <span class="sc">+</span> smoke,</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> NHANES, <span class="at">shrinkage =</span> <span class="st">&#39;ridge&#39;</span>,</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">n.adapt =</span> <span class="dv">0</span>)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Note: No MCMC sample will be created when n.iter is set to 0.</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>mod11b <span class="ot">&lt;-</span> <span class="fu">lm_imp</span>(SBP <span class="sc">~</span> gender <span class="sc">+</span> age <span class="sc">+</span> race <span class="sc">+</span> educ <span class="sc">+</span> occup <span class="sc">+</span> smoke,</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> NHANES, <span class="at">shrinkage =</span> <span class="fu">c</span>(<span class="at">SBP =</span> <span class="st">&#39;ridge&#39;</span>, <span class="at">educ =</span> <span class="st">&#39;ridge&#39;</span>),</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">n.adapt =</span> <span class="dv">0</span>)</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Note: No MCMC sample will be created when n.iter is set to 0.</span></span></code></pre></div>
<p>Ridge regression is implemented as a <span
class="math inline">\(\text{Ga}(0.01, 0.01)\)</span> prior for the
precision of the regression coefficients <span
class="math inline">\(\beta\)</span> instead of setting this precision
to a fixed (small) value.</p>
</div>
<div class="footnotes footnotes-end-of-document">
<hr />
<ol>
<li id="fn1"><p>Note: these examples are chosen to demonstrate
functionality and may not fit the data.<a href="#fnref1"
class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>Again, this is just a demonstration of the possibilities
in JointAI, but nesting transformations will most often result in
coefficients that that do not have meaningful interpretation in
practice.<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>Van Buuren, S. (2012). Flexible imputation of missing
data. Chapman and Hall/CRC. See also the <a
href="https://stefvanbuuren.name/fimd/">second edition online</a>.<a
href="#fnref3" class="footnote-back">↩︎</a></p></li>
</ol>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
